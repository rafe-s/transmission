(()=>{var Ot=Object.create;var Me=Object.defineProperty;var Tt=Object.getOwnPropertyDescriptor;var Rt=Object.getOwnPropertyNames;var Yt=Object.getPrototypeOf,Nt=Object.prototype.hasOwnProperty;var Vt=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports);var Dt=(o,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Rt(e))!Nt.call(o,s)&&s!==t&&Me(o,s,{get:()=>e[s],enumerable:!(r=Tt(e,s))||r.enumerable});return o};var St=(o,e,t)=>(t=o!=null?Ot(Yt(o)):{},Dt(e||!o||!o.__esModule?Me(t,"default",{value:o,enumerable:!0}):t,o));var Lt=Vt((K,z)=>{var _t=200,Je="__lodash_hash_undefined__",pe=1,at=2,ct=9007199254740991,ne="[object Arguments]",Ne="[object Array]",Et="[object AsyncFunction]",lt="[object Boolean]",dt="[object Date]",gt="[object Error]",ut="[object Function]",Ht="[object GeneratorFunction]",ae="[object Map]",pt="[object Number]",Jt="[object Null]",J="[object Object]",Ke="[object Promise]",zt="[object Proxy]",bt="[object RegExp]",ce="[object Set]",mt="[object String]",jt="[object Symbol]",Mt="[object Undefined]",Ve="[object WeakMap]",It="[object ArrayBuffer]",le="[object DataView]",Kt="[object Float32Array]",Pt="[object Float64Array]",$t="[object Int8Array]",qt="[object Int16Array]",er="[object Int32Array]",tr="[object Uint8Array]",rr="[object Uint8ClampedArray]",or="[object Uint16Array]",sr="[object Uint32Array]",ir=/[\\^$.*+?()[\]{}|]/g,nr=/^\[object .+?Constructor\]$/,ar=/^(?:0|[1-9]\d*)$/,X={};X[Kt]=X[Pt]=X[$t]=X[qt]=X[er]=X[tr]=X[rr]=X[or]=X[sr]=!0;X[ne]=X[Ne]=X[It]=X[lt]=X[le]=X[dt]=X[gt]=X[ut]=X[ae]=X[pt]=X[J]=X[bt]=X[ce]=X[mt]=X[Ve]=!1;var ht=typeof global=="object"&&global&&global.Object===Object&&global,cr=typeof self=="object"&&self&&self.Object===Object&&self,O=ht||cr||Function("return this")(),Ct=typeof K=="object"&&K&&!K.nodeType&&K,Pe=Ct&&typeof z=="object"&&z&&!z.nodeType&&z,At=Pe&&Pe.exports===Ct,Te=At&&ht.process,$e=function(){try{return Te&&Te.binding&&Te.binding("util")}catch{}}(),qe=$e&&$e.isTypedArray;function lr(o,e){for(var t=-1,r=o==null?0:o.length,s=0,i=[];++t<r;){var n=o[t];e(n,t,o)&&(i[s++]=n)}return i}function dr(o,e){for(var t=-1,r=e.length,s=o.length;++t<r;)o[s+t]=e[t];return o}function gr(o,e){for(var t=-1,r=o==null?0:o.length;++t<r;)if(e(o[t],t,o))return!0;return!1}function ur(o,e){for(var t=-1,r=Array(o);++t<o;)r[t]=e(t);return r}function pr(o){return function(e){return o(e)}}function br(o,e){return o.has(e)}function mr(o,e){return o?.[e]}function Ir(o){var e=-1,t=Array(o.size);return o.forEach(function(r,s){t[++e]=[s,r]}),t}function hr(o,e){return function(t){return o(e(t))}}function Cr(o){var e=-1,t=Array(o.size);return o.forEach(function(r){t[++e]=r}),t}var Ar=Array.prototype,fr=Function.prototype,be=Object.prototype,Re=O["__core-js_shared__"],ft=fr.toString,U=be.hasOwnProperty,et=function(){var o=/[^.]+$/.exec(Re&&Re.keys&&Re.keys.IE_PROTO||"");return o?"Symbol(src)_1."+o:""}(),Bt=be.toString,Br=RegExp("^"+ft.call(U).replace(ir,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),tt=At?O.Buffer:void 0,de=O.Symbol,rt=O.Uint8Array,Gt=be.propertyIsEnumerable,Gr=Ar.splice,V=de?de.toStringTag:void 0,ot=Object.getOwnPropertySymbols,yr=tt?tt.isBuffer:void 0,xr=hr(Object.keys,Object),De=j(O,"DataView"),P=j(O,"Map"),Se=j(O,"Promise"),_e=j(O,"Set"),Ee=j(O,"WeakMap"),$=j(Object,"create"),vr=_(De),Zr=_(P),Xr=_(Se),Fr=_(_e),Wr=_(Ee),st=de?de.prototype:void 0,Ye=st?st.valueOf:void 0;function D(o){var e=-1,t=o==null?0:o.length;for(this.clear();++e<t;){var r=o[e];this.set(r[0],r[1])}}function Lr(){this.__data__=$?$(null):{},this.size=0}function wr(o){var e=this.has(o)&&delete this.__data__[o];return this.size-=e?1:0,e}function Qr(o){var e=this.__data__;if($){var t=e[o];return t===Je?void 0:t}return U.call(e,o)?e[o]:void 0}function Ur(o){var e=this.__data__;return $?e[o]!==void 0:U.call(e,o)}function kr(o,e){var t=this.__data__;return this.size+=this.has(o)?0:1,t[o]=$&&e===void 0?Je:e,this}D.prototype.clear=Lr;D.prototype.delete=wr;D.prototype.get=Qr;D.prototype.has=Ur;D.prototype.set=kr;function T(o){var e=-1,t=o==null?0:o.length;for(this.clear();++e<t;){var r=o[e];this.set(r[0],r[1])}}function Or(){this.__data__=[],this.size=0}function Tr(o){var e=this.__data__,t=me(e,o);if(t<0)return!1;var r=e.length-1;return t==r?e.pop():Gr.call(e,t,1),--this.size,!0}function Rr(o){var e=this.__data__,t=me(e,o);return t<0?void 0:e[t][1]}function Yr(o){return me(this.__data__,o)>-1}function Nr(o,e){var t=this.__data__,r=me(t,o);return r<0?(++this.size,t.push([o,e])):t[r][1]=e,this}T.prototype.clear=Or;T.prototype.delete=Tr;T.prototype.get=Rr;T.prototype.has=Yr;T.prototype.set=Nr;function S(o){var e=-1,t=o==null?0:o.length;for(this.clear();++e<t;){var r=o[e];this.set(r[0],r[1])}}function Vr(){this.size=0,this.__data__={hash:new D,map:new(P||T),string:new D}}function Dr(o){var e=Ie(this,o).delete(o);return this.size-=e?1:0,e}function Sr(o){return Ie(this,o).get(o)}function _r(o){return Ie(this,o).has(o)}function Er(o,e){var t=Ie(this,o),r=t.size;return t.set(o,e),this.size+=t.size==r?0:1,this}S.prototype.clear=Vr;S.prototype.delete=Dr;S.prototype.get=Sr;S.prototype.has=_r;S.prototype.set=Er;function ge(o){var e=-1,t=o==null?0:o.length;for(this.__data__=new S;++e<t;)this.add(o[e])}function Hr(o){return this.__data__.set(o,Je),this}function Jr(o){return this.__data__.has(o)}ge.prototype.add=ge.prototype.push=Hr;ge.prototype.has=Jr;function Y(o){var e=this.__data__=new T(o);this.size=e.size}function zr(){this.__data__=new T,this.size=0}function jr(o){var e=this.__data__,t=e.delete(o);return this.size=e.size,t}function Mr(o){return this.__data__.get(o)}function Kr(o){return this.__data__.has(o)}function Pr(o,e){var t=this.__data__;if(t instanceof T){var r=t.__data__;if(!P||r.length<_t-1)return r.push([o,e]),this.size=++t.size,this;t=this.__data__=new S(r)}return t.set(o,e),this.size=t.size,this}Y.prototype.clear=zr;Y.prototype.delete=jr;Y.prototype.get=Mr;Y.prototype.has=Kr;Y.prototype.set=Pr;function $r(o,e){var t=ue(o),r=!t&&bo(o),s=!t&&!r&&He(o),i=!t&&!r&&!s&&Wt(o),n=t||r||s||i,l=n?ur(o.length,String):[],a=l.length;for(var c in o)(e||U.call(o,c))&&!(n&&(c=="length"||s&&(c=="offset"||c=="parent")||i&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||co(c,a)))&&l.push(c);return l}function me(o,e){for(var t=o.length;t--;)if(vt(o[t][0],e))return t;return-1}function qr(o,e,t){var r=e(o);return ue(o)?r:dr(r,t(o))}function ee(o){return o==null?o===void 0?Mt:Jt:V&&V in Object(o)?no(o):po(o)}function it(o){return q(o)&&ee(o)==ne}function yt(o,e,t,r,s){return o===e?!0:o==null||e==null||!q(o)&&!q(e)?o!==o&&e!==e:eo(o,e,t,r,yt,s)}function eo(o,e,t,r,s,i){var n=ue(o),l=ue(e),a=n?Ne:R(o),c=l?Ne:R(e);a=a==ne?J:a,c=c==ne?J:c;var g=a==J,u=c==J,d=a==c;if(d&&He(o)){if(!He(e))return!1;n=!0,g=!1}if(d&&!g)return i||(i=new Y),n||Wt(o)?xt(o,e,t,r,s,i):so(o,e,a,t,r,s,i);if(!(t&pe)){var p=g&&U.call(o,"__wrapped__"),b=u&&U.call(e,"__wrapped__");if(p||b){var I=p?o.value():o,A=b?e.value():e;return i||(i=new Y),s(I,A,t,r,i)}}return d?(i||(i=new Y),io(o,e,t,r,s,i)):!1}function to(o){if(!Ft(o)||go(o))return!1;var e=Zt(o)?Br:nr;return e.test(_(o))}function ro(o){return q(o)&&Xt(o.length)&&!!X[ee(o)]}function oo(o){if(!uo(o))return xr(o);var e=[];for(var t in Object(o))U.call(o,t)&&t!="constructor"&&e.push(t);return e}function xt(o,e,t,r,s,i){var n=t&pe,l=o.length,a=e.length;if(l!=a&&!(n&&a>l))return!1;var c=i.get(o);if(c&&i.get(e))return c==e;var g=-1,u=!0,d=t&at?new ge:void 0;for(i.set(o,e),i.set(e,o);++g<l;){var p=o[g],b=e[g];if(r)var I=n?r(b,p,g,e,o,i):r(p,b,g,o,e,i);if(I!==void 0){if(I)continue;u=!1;break}if(d){if(!gr(e,function(A,y){if(!br(d,y)&&(p===A||s(p,A,t,r,i)))return d.push(y)})){u=!1;break}}else if(!(p===b||s(p,b,t,r,i))){u=!1;break}}return i.delete(o),i.delete(e),u}function so(o,e,t,r,s,i,n){switch(t){case le:if(o.byteLength!=e.byteLength||o.byteOffset!=e.byteOffset)return!1;o=o.buffer,e=e.buffer;case It:return!(o.byteLength!=e.byteLength||!i(new rt(o),new rt(e)));case lt:case dt:case pt:return vt(+o,+e);case gt:return o.name==e.name&&o.message==e.message;case bt:case mt:return o==e+"";case ae:var l=Ir;case ce:var a=r&pe;if(l||(l=Cr),o.size!=e.size&&!a)return!1;var c=n.get(o);if(c)return c==e;r|=at,n.set(o,e);var g=xt(l(o),l(e),r,s,i,n);return n.delete(o),g;case jt:if(Ye)return Ye.call(o)==Ye.call(e)}return!1}function io(o,e,t,r,s,i){var n=t&pe,l=nt(o),a=l.length,c=nt(e),g=c.length;if(a!=g&&!n)return!1;for(var u=a;u--;){var d=l[u];if(!(n?d in e:U.call(e,d)))return!1}var p=i.get(o);if(p&&i.get(e))return p==e;var b=!0;i.set(o,e),i.set(e,o);for(var I=n;++u<a;){d=l[u];var A=o[d],y=e[d];if(r)var G=n?r(y,A,d,e,o,i):r(A,y,d,o,e,i);if(!(G===void 0?A===y||s(A,y,t,r,i):G)){b=!1;break}I||(I=d=="constructor")}if(b&&!I){var B=o.constructor,C=e.constructor;B!=C&&"constructor"in o&&"constructor"in e&&!(typeof B=="function"&&B instanceof B&&typeof C=="function"&&C instanceof C)&&(b=!1)}return i.delete(o),i.delete(e),b}function nt(o){return qr(o,ho,ao)}function Ie(o,e){var t=o.__data__;return lo(e)?t[typeof e=="string"?"string":"hash"]:t.map}function j(o,e){var t=mr(o,e);return to(t)?t:void 0}function no(o){var e=U.call(o,V),t=o[V];try{o[V]=void 0;var r=!0}catch{}var s=Bt.call(o);return r&&(e?o[V]=t:delete o[V]),s}var ao=ot?function(o){return o==null?[]:(o=Object(o),lr(ot(o),function(e){return Gt.call(o,e)}))}:Co,R=ee;(De&&R(new De(new ArrayBuffer(1)))!=le||P&&R(new P)!=ae||Se&&R(Se.resolve())!=Ke||_e&&R(new _e)!=ce||Ee&&R(new Ee)!=Ve)&&(R=function(o){var e=ee(o),t=e==J?o.constructor:void 0,r=t?_(t):"";if(r)switch(r){case vr:return le;case Zr:return ae;case Xr:return Ke;case Fr:return ce;case Wr:return Ve}return e});function co(o,e){return e=e??ct,!!e&&(typeof o=="number"||ar.test(o))&&o>-1&&o%1==0&&o<e}function lo(o){var e=typeof o;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?o!=="__proto__":o===null}function go(o){return!!et&&et in o}function uo(o){var e=o&&o.constructor,t=typeof e=="function"&&e.prototype||be;return o===t}function po(o){return Bt.call(o)}function _(o){if(o!=null){try{return ft.call(o)}catch{}try{return o+""}catch{}}return""}function vt(o,e){return o===e||o!==o&&e!==e}var bo=it(function(){return arguments}())?it:function(o){return q(o)&&U.call(o,"callee")&&!Gt.call(o,"callee")},ue=Array.isArray;function mo(o){return o!=null&&Xt(o.length)&&!Zt(o)}var He=yr||Ao;function Io(o,e){return yt(o,e)}function Zt(o){if(!Ft(o))return!1;var e=ee(o);return e==ut||e==Ht||e==Et||e==zt}function Xt(o){return typeof o=="number"&&o>-1&&o%1==0&&o<=ct}function Ft(o){var e=typeof o;return o!=null&&(e=="object"||e=="function")}function q(o){return o!=null&&typeof o=="object"}var Wt=qe?pr(qe):ro;function ho(o){return mo(o)?$r(o):oo(o)}function Co(){return[]}function Ao(){return!1}z.exports=Io});var ie=class o extends EventTarget{constructor(){super(),this.actions=Object.seal({"deselect-all":{enabled:!1,shortcut:"D",text:"Deselect all"},"move-bottom":{enabled:!1,text:"Bottom"},"move-down":{enabled:!1,text:"Down"},"move-top":{enabled:!1,text:"Top"},"move-up":{enabled:!1,text:"Up"},"open-torrent":{enabled:!0,shortcut:"O",text:"Open torrent\u2026"},"pause-all-torrents":{enabled:!1,text:"Pause all"},"pause-selected-torrents":{enabled:!1,shortcut:"U",text:"Pause"},"reannounce-selected-torrents":{enabled:!1,text:"Ask tracker for more peers"},"remove-selected-torrents":{enabled:!1,text:"Remove selected torrents"},"resume-selected-torrents":{enabled:!1,shortcut:"R",text:"Resume"},"resume-selected-torrents-now":{enabled:!1,text:"Resume now"},"select-all":{enabled:!1,shortcut:"A",text:"Select all"},"show-about-dialog":{enabled:!0,text:"About"},"show-inspector":{enabled:!1,shortcut:"I",text:"Torrent Inspector"},"show-labels-dialog":{enabled:!1,shortcut:"K",text:"Edit Labels\u2026"},"show-move-dialog":{enabled:!1,shortcut:"L",text:"Set location\u2026"},"show-overflow-menu":{enabled:!0,text:"More options\u2026"},"show-preferences-dialog":{enabled:!0,shortcut:"P",text:"Edit preferences"},"show-rename-dialog":{enabled:!1,shortcut:"N",text:"Rename\u2026"},"show-shortcuts-dialog":{enabled:!0,text:"Keyboard shortcuts"},"show-statistics-dialog":{enabled:!0,shortcut:"S",text:"Statistics"},"start-all-torrents":{enabled:!1,text:"Start all"},"toggle-compact-rows":{enabled:!0,text:"Compact rows"},"toggle-contrast":{enabled:!0,text:"High contrast UI"},"verify-selected-torrents":{enabled:!1,shortcut:"V",text:"Verify local data"}})}click(e){if(this.isEnabled(e)){let t=new Event("click");t.action=e,this.dispatchEvent(t)}}getActionForShortcut(e){for(let[t,r]of Object.entries(this.actions))if(e===r.shortcut)return t;return null}allShortcuts(){return new Map(Object.entries(this.actions).filter(([,e])=>e.shortcut).map(([e,t])=>[t.shortcut,e]))}isEnabled(e){return this._getAction(e).enabled}text(e){return this._getAction(e).text}keyshortcuts(e){return this._getAction(e).shortcut}update(e){let t=o._recount(e.selected,e.nonselected);this._updateStates(t)}_getAction(e){let t=this.actions[e];if(!t)throw new Error(`no such action: ${e}`);return t}static _recount(e,t){let r=e.length+t.length,s=e.filter(u=>u.isStopped()).length,i=e.length-s,n=t.filter(u=>u.isStopped()).length,l=t.length-n,a=s+n,c=i+l,g=e.filter(u=>u.isQueued()).length;return{active:c,nonselected_active:l,nonselected_paused:n,paused:a,selected:e.length,selected_active:i,selected_paused:s,selected_queued:g,total:r}}_updateStates(e){let t=(r,s)=>{for(let i of s)this._updateActionState(i,r)};t(e.selected_paused>0,["resume-selected-torrents"]),t(e.paused>0,["start-all-torrents"]),t(e.active>0,["pause-all-torrents"]),t(e.selected_paused>0||e.selected_queued>0,["resume-selected-torrents-now"]),t(e.selected_active>0,["pause-selected-torrents","reannounce-selected-torrents"]),t(e.selected>0,["deselect-all","move-bottom","move-down","move-top","move-up","remove-selected-torrents","show-inspector","show-labels-dialog","show-move-dialog","verify-selected-torrents"]),t(e.selected===1,["show-rename-dialog"]),t(e.selected<e.total,["select-all"])}_updateActionState(e,t){let r=this.actions[e];if(!r)throw new Error(`no such action: ${e}`);if(r.enabled!==t){r.enabled=t;let s=new Event("change");s.action=e,s.enabled=t,this.dispatchEvent(s)}}};var wt=St(Lt(),1);var te={ratio(o,e){let t=Math.floor(100*o/e)/100;return t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY?t=-2:Number.isNaN(t)&&(t=-1),t}};function fo(o,e,t,r,s){for(let i of o.children)i.classList.toggle("selected",i===e);for(let i of t.children)i.classList.toggle("hidden",i!==r);s&&s(r)}function he(o,e,t){let r=document.createElement("div");r.id=o,r.classList.add("tabs-container");let s=document.createElement("div");s.classList.add("tabs-buttons"),r.append(s);let i=document.createElement("button");i.classList.add("tabs-container-close"),i.innerHTML="&times;",r.append(i);let n=document.createElement("div");n.classList.add("tabs-pages"),r.append(n);let l=[];for(let[a,c,g]of e){let u=document.createElement("button");u.id=a,u.classList.add("tabs-button"),u.setAttribute("type","button"),u.textContent=g,s.append(u),l.push(u),c.classList.add("hidden","tabs-page"),n.append(c),u.addEventListener("click",()=>fo(s,u,n,c,t))}return l[0].classList.add("selected"),n.children[0].classList.remove("hidden"),{buttons:l,dismiss:i,root:r}}function W(o){let e=document.createElement("dialog");e.classList.add("dialog-container","popup",o),e.open=!0,e.setAttribute("role","dialog");let t=document.createElement("div");t.classList.add("dialog-window"),e.append(t);let r=document.createElement("div");r.classList.add("dialog-logo"),t.append(r);let s=document.createElement("div");s.classList.add("dialog-heading"),t.append(s);let i=document.createElement("div");i.classList.add("dialog-message"),t.append(i);let n=document.createElement("div");n.classList.add("dialog-workarea"),t.append(n);let l=document.createElement("div");l.classList.add("dialog-buttons"),t.append(l);let a=document.createElement("span");a.classList.add("dialog-buttons-begin"),l.append(a);let c=document.createElement("button");c.classList.add("dialog-dismiss-button"),c.textContent="Cancel",l.append(c);let g=document.createElement("button");g.textContent="OK",l.append(g),t.addEventListener("keyup",({key:d})=>{d==="Enter"&&g.click()});let u=document.createElement("span");return u.classList.add("dialog-buttons-end"),l.append(u),{confirm:g,dismiss:c,heading:s,message:i,root:e,workarea:n}}function F(){return typeof crypto.randomUUID=="function"?crypto.randomUUID():("10000000-1000-4000-8000"+-1e11).replaceAll(/[018]/g,o=>(o^crypto.getRandomValues(new Uint8Array(1))[0]&15>>o/4).toString(16))}function Bo(o){let e=document.createElement("fieldset");e.classList.add("section");let t=document.createElement("legend");t.classList.add("title"),t.textContent=o,e.append(t);let r=document.createElement("div");return r.classList.add("content"),e.append(r),{content:r,root:e}}function ze(o,e){let t=[],{root:r,content:s}=Bo(o);for(let i of e){let n=document.createElement("label");n.textContent=i,s.append(n);let l=document.createElement("div");l.id=F(),s.append(l),n.setAttribute("for",l.id),t.push(l)}return{children:t,root:r}}function E(o,e=100){let t=null;return(...r)=>{t||(t=setTimeout(()=>{t=null,o(...r)},e))}}function Ce(o,e){return(0,wt.default)(o,e)}function Go(o,e,t){t?o.setAttribute(e,!0):o.removeAttribute(e)}function w(o,e){Go(o,"disabled",!e)}function Ae(o,e){o.classList.toggle("checked",e)}var N=class extends EventTarget{constructor(e){super(),this.listener=t=>{e.contains(t.target)||(this.dispatchEvent(new MouseEvent(t.type,t)),t.preventDefault())},Object.seal(this),this.start()}start(){setTimeout(()=>document.addEventListener("click",this.listener),0)}stop(){document.removeEventListener("click",this.listener)}};function h(o,e){o.textContent!==e&&(o.textContent=e)}var fe=class{constructor(e){this._prefs=e,this._elements={toggle:document.querySelector("#toggle-notifications")}}_setEnabled(e){this.prefs.notifications_enabled=e,h(this._toggle,`${e?"Disable":"Enable"} Notifications`)}_requestPermission(){Notification.requestPermission().then(e=>this._setEnabled(e==="granted"))}toggle(){this._enabled?this._setEnabled(!1):Notification.permission==="granted"?this._setEnabled(!0):Notification.permission!=="denied"&&this._requestPermission()}};var m=class o extends EventTarget{constructor(){super(),this._cache={},this.dispatchPrefsChange=E((e,t,r)=>{let s=new Event("change");Object.assign(s,{key:e,old_value:t,value:r}),this.dispatchEvent(s)});for(let[e,t]of Object.entries(o._Defaults))this._set(e,o._getCookie(e,t)),Object.defineProperty(this,e.replaceAll("-","_"),{get:()=>this._get(e),set:r=>{this._set(e,r)}});Object.seal(this)}entries(){return Object.entries(this._cache)}keys(){return Object.keys(this._cache)}_get(e){let{_cache:t}=this;if(!Object.prototype.hasOwnProperty.call(t,e))throw new Error(e);return t[e]}_set(e,t){let{_cache:r}=this,s=r[e];s!==t&&(r[e]=t,o._setCookie(e,t),this.dispatchPrefsChange(e,s,t))}static _setCookie(e,t){let r=new Date;r.setFullYear(r.getFullYear()+1),document.cookie=`${e}=${t}; SameSite=Strict; expires=${r.toGMTString()}`}static _getCookie(e,t){let r=o._readCookie(e);if(r===null)return t;let s=typeof t;if(s==="boolean")return r==="true"?!0:r==="false"?!1:t;if(s==="number"){let i=Number.parseFloat(r);return Number.isNaN(i)?t:i}return r}static _readCookie(e){let r=`; ${document.cookie}`.split(`; ${e}=`);return r.length===2?r.pop().split(";").shift():null}};m.AltSpeedEnabled="alt-speed-enabled";m.DisplayCompact="compact";m.DisplayFull="full";m.DisplayMode="display-mode";m.ContrastLess="less";m.ContrastMore="more";m.ContrastMode="contrast-mode";m.FilterActive="active";m.FilterAll="all";m.FilterDownloading="downloading";m.FilterFinished="finished";m.FilterMode="filter-mode";m.FilterPaused="paused";m.FilterSeeding="seeding";m.NotificationsEnabled="notifications-enabled";m.RefreshRate="refresh-rate-sec";m.SortAscending="ascending";m.SortByActivity="activity";m.SortByAge="age";m.SortByName="name";m.SortByProgress="progress";m.SortByQueue="queue";m.SortByRatio="ratio";m.SortBySize="size";m.SortByState="state";m.SortDescending="descending";m.SortDirection="sort-direction";m.SortMode="sort-mode";m._Defaults={[m.AltSpeedEnabled]:!1,[m.DisplayMode]:m.DisplayFull,[m.ContrastMode]:window.matchMedia("(prefers-contrast: more)").matches?m.ContrastMore:m.ContrastLess,[m.FilterMode]:m.FilterAll,[m.NotificationsEnabled]:!1,[m.RefreshRate]:5,[m.SortDirection]:m.SortAscending,[m.SortMode]:m.SortByName};var Be=class o extends EventTarget{constructor(e){super(),this.elements=o._create(e),this.elements.dismiss.addEventListener("click",()=>this.close()),document.body.append(this.elements.root),this.elements.dismiss.focus()}close(){this.elements.root.remove(),this.dispatchEvent(new Event("close")),delete this.elements}static _create(e){let t=W("about-dialog");t.root.setAttribute("aria-label","About transmission"),t.heading.textContent="Transmission",t.dismiss.textContent="Close";let r=document.createElement("div");return r.classList.add("about-dialog-version-number"),r.textContent=e.version,t.heading.append(r),r=document.createElement("div"),r.classList.add("about-dialog-version-checksum"),r.textContent=e.checksum,t.heading.append(r),r=document.createElement("div"),r.textContent="A fast and easy bitTorrent client",t.workarea.append(r),r=document.createElement("div"),r.textContent="Copyright \xA9 The Transmission Project",t.workarea.append(r),r=document.createElement("a"),r.href="https://transmissionbt.com/",r.target="_blank",r.textContent="https://transmissionbt.com/",t.workarea.append(r),t.confirm.remove(),delete t.confirm,t}};var Ge=class extends EventTarget{constructor(e){super(),this.action_listener=this._update.bind(this),this.action_manager=e,this.action_manager.addEventListener("change",this.action_listener),Object.assign(this,this._create()),this.outside=new N(this.root),this.outside.addEventListener("click",()=>this.close()),this.show()}show(){for(let[e,t]of Object.entries(this.actions))w(t,this.action_manager.isEnabled(e));document.body.append(this.root)}close(){if(!this.closed){this.outside.stop(),this.action_manager.removeEventListener("change",this.action_listener),this.root.remove(),this.dispatchEvent(new Event("close"));for(let e of Object.keys(this))delete this[e];this.closed=!0}}_update(e){let t=this.actions[e.action];t&&w(t,e.enabled)}_create(){let e=document.createElement("div");e.role="menu",e.classList.add("context-menu","popup"),e.addEventListener("contextmenu",n=>{n.preventDefault()}),e.style.pointerEvents="none";let t={},r=(n,l=!1)=>{let a=document.createElement("div"),c=this.action_manager.text(n);a.role="menuitem",l?a.classList.add("context-menuitem","warning"):a.classList.add("context-menuitem"),a.dataset.action=n,a.textContent=c;let g=this.action_manager.keyshortcuts(n);return g&&a.setAttribute("aria-keyshortcuts",g),a.addEventListener("click",()=>{this.action_manager.click(n),this.close()}),t[n]=a,a},s=()=>{let n=document.createElement("div");return n.classList.add("context-menu-separator"),n};add_item("resume-selected-torrents"),add_item("resume-selected-torrents-now"),add_item("pause-selected-torrents"),add_separator(),add_item("move-top"),add_item("move-up"),add_item("move-down"),add_item("move-bottom"),add_separator(),add_item("remove-selected-torrents",!0),add_separator(),add_item("verify-selected-torrents"),add_item("show-move-dialog"),add_item("show-rename-dialog"),add_item("show-labels-dialog"),add_separator(),add_item("reannounce-selected-torrents"),add_separator(),add_item("select-all"),add_item("deselect-all");let i=(n,...l)=>{let a=document.createElement("div");a.className="context-menuitem",a.textContent=n;let c=document.createElement("div");c.className="arrow",a.append(c);let g=document.createElement("div");g.className="submenu",c.append(g);let u=document.createElement("div");return u.className="open right",g.append(u),u.append(...l.map(d=>r(d))),a.addEventListener("click",d=>{let p=a.lastChild.lastChild;if(!d.target.classList.contains("right")&&!d.target.parentNode.classList.contains("right")&&!d.target.classList.contains("left")&&!d.target.parentNode.classList.contains("left")&&p.style.display==="block"){p.style.display="none";return}for(let G of e.querySelectorAll(".submenu"))G.style.display="none";p.style.display="block";let b=a.getBoundingClientRect(),I=p.lastChild.getBoundingClientRect(),A=Math.min(0,document.documentElement.clientHeight-window.visualViewport.offsetTop-b.top-p.clientHeight+3),y=Math.min(0,document.documentElement.clientWidth-window.visualViewport.offsetLeft-b.right-p.clientWidth);p.style.top=`${A}px`,y?(p.lastChild.className="open left",p.style.left=`${-b.width-I.width}px`):(p.lastChild.className="open right",p.style.left=`${y}px`)}),a};return e.append(r("resume-selected-torrents"),r("resume-selected-torrents-now"),r("pause-selected-torrents"),s(),i("Move in the queue","move-top","move-up","move-down","move-bottom"),s(),r("remove-selected-torrents",!0),r("trash-selected-torrents",!0),s(),r("verify-selected-torrents"),r("show-move-dialog"),r("show-rename-dialog"),r("show-labels-dialog"),s(),r("reannounce-selected-torrents"),s(),i("Select operation","select-all","deselect-all")),{actions:t,root:e}}};var Qt=new Intl.PluralRules,k=Qt.resolvedOptions().locale,yo=new Intl.NumberFormat(k),je=1e3,xo=[new Intl.NumberFormat(k,{maximumFractionDigits:0,style:"unit",unit:"byte"}),new Intl.NumberFormat(k,{maximumFractionDigits:0,style:"unit",unit:"kilobyte"}),new Intl.NumberFormat(k,{maximumFractionDigits:0,style:"unit",unit:"megabyte"}),new Intl.NumberFormat(k,{maximumFractionDigits:2,style:"unit",unit:"gigabyte"}),new Intl.NumberFormat(k,{maximumFractionDigits:2,style:"unit",unit:"terabyte"}),new Intl.NumberFormat(k,{maximumFractionDigits:2,style:"unit",unit:"petabyte"})],vo=new Intl.NumberFormat(k,{maximumFractionDigits:2,style:"unit",unit:"kilobyte-per-second"}),Zo=new Intl.NumberFormat(k,{maximumFractionDigits:2,style:"unit",unit:"megabyte-per-second"}),Xo=new Intl.NumberFormat(k,{maximumFractionDigits:2,style:"unit",unit:"gigabyte-per-second"}),v={_toTruncFixed(o,e){return(Math.floor(o*10**e)/10**e).toFixed(e)},countString(o,e,t){return`${this.number(t)} ${this.ngettext(o,e,t)}`},mem(o){if(o<0)return"Unknown";if(o===0)return"None";let e=o;for(let t of xo){if(e<je)return t.format(e);e/=je}return"E2BIG"},ngettext(o,e,t){return Qt.select(t)==="one"?o:e},number(o){return yo.format(o)},percentString(o,e){return e=o<100?e:0,this._toTruncFixed(o,e)},ratioString(o){return o===-1?"None":o===-2?"&infin;":this.percentString(o,1)},size(o){return this.mem(o)},speed(o){return o<999.95?vo.format(o):o<999950?Zo.format(o/1e3):Xo.format(o/1e6)},speedBps(o){return this.speed(this.toKBps(o))},stringSanitizer(o){return["E2BIG","NaN"].some(e=>o.includes(e))?"\u2026":o},timeInterval(o,e=3){let t=Math.floor(o/86400),r=[];t&&r.push(this.countString("day","days",t));let s=Math.floor(o%86400/3600);(t||s)&&r.push(this.countString("hour","hours",s));let i=Math.floor(o%3600/60);return t||s||i?(r.push(this.countString("minute","minutes",i)),r=r.slice(0,e),r.length>1?`${r.slice(0,-1).join(", ")} and ${r.slice(-1)}`:r[0]):this.countString("second","seconds",Math.floor(o%60))},timestamp(o){if(!o)return"N/A";let e=new Date(o*1e3),t=new Date,r="",s="",i=t.getFullYear()===e.getFullYear(),n=t.getMonth()===e.getMonth(),l=t.getDate()-e.getDate();i&&n&&Math.abs(l)<=1?l===0?r="Today":l===1?r="Yesterday":r="Tomorrow":r=e.toDateString();let a=e.getHours(),c="AM";a>12&&(a=a-12,c="PM"),a===0&&(a=12),a<10&&(a=`0${a}`);let g=e.getMinutes();return g<10&&(g=`0${g}`),o=e.getSeconds(),o<10&&(o=`0${o}`),s=[a,g,o].join(":"),[r,s,c].join(" ")},toKBps(o){return Math.floor(o/je)}};var ye=class extends EventTarget{isDone(){return this.fields.have>=this.fields.size}isEditable(){return this.fields.torrent.getFileCount()>1&&!this.isDone()}refreshWantedHTML(){let e=this.elements.root;e.classList.toggle("skip",!this.fields.isWanted),e.classList.toggle("complete",this.isDone()),w(e.checkbox,this.isEditable()),e.checkbox.checked=this.fields.isWanted}refreshProgressHTML(){let{size:e,have:t}=this.fields,r=100*(e?t/e:1),s=v,i=`${s.size(t)} of ${s.size(e)} (${s.percentString(r,1)}%)`;h(this.elements.progress,i)}refresh(){let e=0,t=!1,r=!1,s=!1,i=0,n=!1,l=this.fields.torrent.getFiles();for(let a of this.fields.indices){let c=l[a];switch(e+=c.bytesCompleted,i+=c.length,n|=c.wanted,c.priority.toString()){case"-1":r=!0;break;case"1":t=!0;break;default:s=!0;break}}Ae(this.elements.priority_low_button,r),Ae(this.elements.priority_normal_button,s),Ae(this.elements.priority_high_button,t),(this.fields.have!==e||this.fields.size!==i)&&(this.fields.have=e,this.fields.size=i,this.refreshProgressHTML()),this.fields.isWanted!==n&&(this.fields.isWanted=n,this.refreshWantedHTML())}fireWantedChanged(e){let t=new Event("wantedToggled");t.indices=[...this.fields.indices],t.wanted=e,this.dispatchEvent(t)}firePriorityChanged(e){let t=new Event("priorityToggled");t.indices=[...this.fields.indices],t.priority=e,this.dispatchEvent(t)}createRow(e,t,r){let s=document.createElement("li");s.classList.add("inspector-torrent-file-list-entry"),this.elements.root=s;let i=document.createElement("input"),n=F();i.type="checkbox",i.className="file-wanted-control",i.title="Download file",i.id=n,i.addEventListener("change",c=>this.fireWantedChanged(c.target.checked)),s.checkbox=i,s.append(i),i=document.createElement("label"),i.className="inspector-torrent-file-list-entry-name",i.setAttribute("for",n),h(i,r),s.append(i),i=document.createElement("div"),i.className="inspector-torrent-file-list-entry-progress",s.append(i),this.elements.progress=i,i=document.createElement("div"),i.className="file-priority-radiobox";let l=i,a=c=>this.firePriorityChanged(c.target.value);i=document.createElement("input"),i.type="radio",i.value="-1",i.className="low",i.title="Low Priority",i.addEventListener("click",a),this.elements.priority_low_button=i,l.append(i),i=document.createElement("input"),i.type="radio",i.value="0",i.className="normal",i.title="Normal Priority",i.addEventListener("click",a),this.elements.priority_normal_button=i,l.append(i),i=document.createElement("input"),i.type="radio",i.value="1",i.title="High Priority",i.className="high",i.addEventListener("click",a),this.elements.priority_high_button=i,l.append(i),s.append(l),s.style.paddingLeft=`${t*20}px`,this.refresh()}getElement(){return this.elements.root}constructor(e,t,r,s){super(),this.fields={have:0,indices:s,isWanted:!0,size:0,torrent:e},this.elements={priority_high_button:null,priority_low_button:null,priority_normal_button:null,progress:null,root:null},this.createRow(e,t,r)}};var f=class o extends EventTarget{constructor(e){super(),this.fieldObservers={},this.fields={},this.refresh(e)}notifyOnFieldChange(e,t){this.fieldObservers[e]=this.fieldObservers[e]||[],this.fieldObservers[e].push(t)}setField(e,t,r){let s=e[t];if(Ce(s,r))return!1;let i=this.fieldObservers[t];if(e===this.fields&&i&&i.length>0)for(let n of i)n.call(this,r,s,t);return e[t]=r,!0}updateFiles(e){let t=!1,r=this.fields.files||[],s=["length","name","bytesCompleted","wanted","priority"];for(let[i,n]of e.entries()){let l=r[i]||{};for(let a of s)a in n&&(t|=this.setField(l,a,n[a]));r[i]=l}return this.fields.files=r,t}static collateTrackers(e){return e.map(t=>t.announce.toLowerCase()).join("	")}refreshFields(e){let t=!1;for(let[r,s]of Object.entries(e))switch(r){case"files":case"fileStats":t|=this.updateFiles(s);break;case"trackerStats":t|=this.setField(this.fields,"trackers",s);break;case"trackers":r in this.fields||(t|=this.setField(this.fields,r,s));break;case"name":this.setField(this.fields,r,e[r])&&(this.fields.collatedName="",t=!0);break;default:t|=this.setField(this.fields,r,s)}return t}refresh(e){this.refreshFields(e)&&this.dispatchEvent(new Event("dataChanged"))}getComment(){return this.fields.comment}getCreator(){return this.fields.creator}getDateAdded(){return this.fields.addedDate}getDateCreated(){return this.fields.dateCreated}getDesiredAvailable(){return this.fields.desiredAvailable}getDownloadDir(){return this.fields.downloadDir}getDownloadSpeed(){return this.fields.rateDownload}getDownloadedEver(){return this.fields.downloadedEver}getError(){return this.fields.error}getErrorString(){return this.fields.errorString}getETA(){return this.fields.eta}getFailedEver(){return this.fields.corruptEver}getFiles(){return this.fields.files||[]}getFile(e){return this.fields.files[e]}getFileCount(){return this.fields["file-count"]}getHashString(){return this.fields.hashString}getHave(){return this.getHaveValid()+this.getHaveUnchecked()}getHaveUnchecked(){return this.fields.haveUnchecked}getHaveValid(){return this.fields.haveValid}getId(){return this.fields.id}getLabels(){return this.fields.labels.sort()}getLastActivity(){return this.fields.activityDate}getLeftUntilDone(){return this.fields.leftUntilDone}getMagnetLink(){return this.fields.magnetLink}getMetadataPercentComplete(){return this.fields.metadataPercentComplete}getName(){return this.fields.name||"Unknown"}getPeers(){return this.fields.peers||[]}getPeersConnected(){return this.fields.peersConnected}getPeersGettingFromUs(){return this.fields.peersGettingFromUs}getPeersSendingToUs(){return this.fields.peersSendingToUs}getPieceCount(){return this.fields.pieceCount}getPieceSize(){return this.fields.pieceSize}getPrimaryMimeType(){return this.fields["primary-mime-type"]||"application/octet-stream"}getPrivateFlag(){return this.fields.isPrivate}getQueuePosition(){return this.fields.queuePosition}getRecheckProgress(){return this.fields.recheckProgress}getSeedRatioLimit(){return this.fields.seedRatioLimit}getSeedRatioMode(){return this.fields.seedRatioMode}getSizeWhenDone(){return this.fields.sizeWhenDone}getStartDate(){return this.fields.startDate}getStatus(){return this.fields.status}getTotalSize(){return this.fields.totalSize}getTrackers(){return this.fields.trackers||[]}getUploadSpeed(){return this.fields.rateUpload}getUploadRatio(){return this.fields.uploadRatio}getUploadedEver(){return this.fields.uploadedEver}getWebseedsSendingToUs(){return this.fields.webseedsSendingToUs}isFinished(){return this.fields.isFinished}hasExtraInfo(){return"hashString"in this.fields}isSeeding(){return this.getStatus()===o._StatusSeed}isStopped(){return this.getStatus()===o._StatusStopped}isChecking(){return this.getStatus()===o._StatusCheck}isDownloading(){return this.getStatus()===o._StatusDownload}isQueued(){return this.getStatus()===o._StatusDownloadWait||this.getStatus()===o._StatusSeedWait}isDone(){return this.getLeftUntilDone()<1}needsMetaData(){return this.getMetadataPercentComplete()<1}getActivity(){return this.getDownloadSpeed()+this.getUploadSpeed()}getPercentDoneStr(){return v.percentString(100*this.getPercentDone(),1)}getPercentDone(){return this.fields.percentDone}getStateString(){switch(this.getStatus()){case o._StatusStopped:return this.isFinished()?"Seeding complete":"Paused";case o._StatusCheckWait:return"Queued for verification";case o._StatusCheck:return"Verifying local data";case o._StatusDownloadWait:return"Queued for download";case o._StatusDownload:return"Downloading";case o._StatusSeedWait:return"Queued for seeding";case o._StatusSeed:return"Seeding";case null:return"Unknown";default:return"Error"}}seedRatioLimit(e){switch(this.getSeedRatioMode()){case o._RatioUseGlobal:return e.seedRatioLimit();case o._RatioUseLocal:return this.getSeedRatioLimit();default:return-1}}getErrorMessage(){let e=this.getErrorString();switch(this.getError()){case o._ErrTrackerWarning:return`Tracker returned a warning: ${e}`;case o._ErrTrackerError:return`Tracker returned an error: ${e}`;case o._ErrLocalError:return`Error: ${e}`;default:return null}}getCollatedName(){let e=this.fields;return!e.collatedName&&e.name&&(e.collatedName=e.name.toLowerCase()),e.collatedName||""}getCollatedTrackers(){let e=this.fields;return!e.collatedTrackers&&e.trackers&&(e.collatedTrackers=o.collateTrackers(e.trackers)),e.collatedTrackers||""}testState(e,t){switch(t){case m.FilterActive:return this.getPeersGettingFromUs()>0||this.getPeersSendingToUs()>0||this.getWebseedsSendingToUs()>0||this.isChecking();case m.FilterSeeding:return e===o._StatusSeed||e===o._StatusSeedWait;case m.FilterDownloading:return e===o._StatusDownload||e===o._StatusDownloadWait;case m.FilterPaused:return this.isStopped();case m.FilterFinished:return this.isFinished();default:return!0}}test(e){let t=(r,s,i)=>{if(r.length===0)return!0;let n=s();return r.some(l=>l.every(a=>i(a,n)))};return t(e.search,()=>this.getCollatedName(),(r,s)=>s.includes(r))&&t(e.labels,()=>this.getLabels(),(r,s)=>s.some(i=>i.includes(r)))&&t(e.states,()=>this.getStatus(),(r,s)=>this.testState(s,r))&&t(e.trackers,()=>this.getCollatedTrackers(),(r,s)=>s.includes(r))}static compareById(e,t){return e.getId()-t.getId()}static compareByName(e,t){return e.getCollatedName().localeCompare(t.getCollatedName())||o.compareById(e,t)}static compareByQueue(e,t){return e.getQueuePosition()-t.getQueuePosition()}static compareByAge(e,t){let r=e.getDateAdded();return t.getDateAdded()-r||o.compareByQueue(e,t)}static compareByState(e,t){let r=e.getStatus();return t.getStatus()-r||o.compareByQueue(e,t)}static compareByActivity(e,t){let r=e.getActivity();return t.getActivity()-r||o.compareByState(e,t)}static compareByRatio(e,t){let r=e.getUploadRatio(),s=t.getUploadRatio();return r<s?1:r>s?-1:o.compareByState(e,t)}static compareByProgress(e,t){let r=e.getPercentDone(),s=t.getPercentDone();return r-s||o.compareByRatio(e,t)}static compareBySize(e,t){let r=e.getTotalSize(),s=t.getTotalSize();return r-s||o.compareByName(e,t)}static compareTorrents(e,t,r,s){let i=0;switch(r){case m.SortByActivity:i=o.compareByActivity(e,t);break;case m.SortByAge:i=o.compareByAge(e,t);break;case m.SortByQueue:i=o.compareByQueue(e,t);break;case m.SortByProgress:i=o.compareByProgress(e,t);break;case m.SortBySize:i=o.compareBySize(e,t);break;case m.SortByState:i=o.compareByState(e,t);break;case m.SortByRatio:i=o.compareByRatio(e,t);break;case m.SortByName:i=o.compareByName(e,t);break;default:console.log(`Unrecognized sort mode: ${r}`),i=o.compareByName(e,t);break}return s===m.SortDescending&&(i=-i),i}static sortTorrents(e,t,r){switch(t){case m.SortByActivity:e.sort(this.compareByActivity);break;case m.SortByAge:e.sort(this.compareByAge);break;case m.SortByName:e.sort(this.compareByName);break;case m.SortByProgress:e.sort(this.compareByProgress);break;case m.SortByQueue:e.sort(this.compareByQueue);break;case m.SortByRatio:e.sort(this.compareByRatio);break;case m.SortBySize:e.sort(this.compareBySize);break;case m.SortByState:e.sort(this.compareByState);break;default:console.log(`Unrecognized sort mode: ${t}`),e.sort(this.compareByName);break}return r===m.SortDescending&&e.reverse(),e}};f._StatusStopped=0;f._StatusCheckWait=1;f._StatusCheck=2;f._StatusDownloadWait=3;f._StatusDownload=4;f._StatusSeedWait=5;f._StatusSeed=6;f._RatioUseGlobal=0;f._RatioUseLocal=1;f._RatioUnlimited=2;f._ErrNone=0;f._ErrTrackerWarning=1;f._ErrTrackerError=2;f._ErrLocalError=3;f._TrackerInactive=0;f._TrackerWaiting=1;f._TrackerQueued=2;f._TrackerActive=3;f.Fields={};f.Fields.Metadata=["addedDate","file-count","name","primary-mime-type","totalSize"];f.Fields.Stats=["error","errorString","eta","isFinished","isStalled","labels","leftUntilDone","metadataPercentComplete","peersConnected","peersGettingFromUs","peersSendingToUs","percentDone","queuePosition","rateDownload","rateUpload","recheckProgress","seedRatioMode","seedRatioLimit","sizeWhenDone","status","trackers","downloadDir","uploadedEver","uploadRatio","webseedsSendingToUs"];f.Fields.InfoExtra=["comment","creator","dateCreated","files","hashString","isPrivate","magnetLink","pieceCount","pieceSize"];f.Fields.StatsExtra=["activityDate","corruptEver","desiredAvailable","downloadedEver","fileStats","haveUnchecked","haveValid","peers","startDate","trackerStats"];var Ut=["encryption","speed-up","speed-down","percent-done","status","peer-address","peer-app-name"],re=class o extends EventTarget{constructor(e){super(),this.closed=!1,this.controller=e,this.elements=this._create(),this.current_page=this.elements.info.root,this.interval=setInterval(this._refreshTorrents.bind(this),3e3),this.name="inspector",this.selection_listener=t=>this._setTorrents(t.selected),this.torrent_listener=()=>this._updateCurrentPage(),this.torrents=[],this.file_torrent=null,this.file_torrent_n=null,this.file_rows=null,this.elements.dismiss.addEventListener("click",()=>this.close()),Object.seal(this),e.addEventListener("torrent-selection-changed",this.selection_listener),this._setTorrents(this.controller.getSelectedTorrents()),document.querySelector("#mainwin-workarea").append(this.elements.root)}close(){if(!this.closed){clearInterval(this.interval),this._setTorrents([]),this.elements.root.remove(),this.controller.removeEventListener("torrent-selection-changed",this.selection_listener),this.dispatchEvent(new Event("close"));for(let e of Object.keys(this))this[e]=null;this.closed=!0}}static _createInfoPage(e){let t=document.createElement("div");t.classList.add("inspector-info-page");let r={root:t},s=l=>{let a=document.createElement("div");a.textContent=l,a.classList.add("section-label"),t.append(a)},i=(l,a)=>{let c=document.createElement("label");if(h(c,l),t.append(c),a){let u=document.createElement("input");return u.setAttribute("type","text"),u.addEventListener("keydown",d=>{d.key==="Enter"&&(e.action_input_value=u.value,e.action_manager.click(a))}),t.append(u),u}let g=document.createElement("span");return t.append(g),g};s("Torrent");let n=[["name","Name:","show-rename-dialog"],["labels","Labels:","show-labels-dialog"],["location","Location:","show-move-dialog"]];for(let[l,a,c]of n)r[l]=i(a,c);s("Activity"),n=[["have","Have:"],["availability","Availability:"],["uploaded","Uploaded:"],["downloaded","Downloaded:"],["state","State:"],["running_time","Running time:"],["remaining_time","Remaining:"],["last_activity","Last activity:"],["error","Error:"]];for(let[l,a]of n)r[l]=i(a);s("Details"),n=[["name","Name:"],["size","Size:"],["hash","Hash:"],["privacy","Privacy:"],["origin","Origin:"],["dateAdded","Date added:"],["magnetLink","Magnet:"],["comment","Comment:"]];for(let[l,a]of n)r[l]=i(a);return r}static _createListPage(e,t){let r=document.createElement("div"),s=document.createElement(e);return s.id=t,r.append(s),{list:s,root:r}}static _createTiersPage(){return o._createListPage("div","inspector-tiers-list")}static _createFilesPage(){return o._createListPage("ul","inspector-file-list")}static _createPeersPage(){let e=document.createElement("table");e.classList.add("peer-list");let t=document.createElement("thead"),r=document.createElement("tr"),s=["","Up","Down","Done","Status","Address","Client"];for(let[n,l]of s.entries()){let a=document.createElement("th"),c=Ut[n];c==="encryption"&&(a.dataset.encrypted=!0),a.classList.add(c),h(a,l),r.append(a)}let i=document.createElement("tbody");return t.append(r),e.append(t),e.append(i),{root:e,tbody:i}}_create(){let e={files:o._createFilesPage(),info:o._createInfoPage(this.controller),peers:o._createPeersPage(),tiers:o._createTiersPage()},t=s=>{this.current_page=s,this._updateCurrentPage()};return{...he("inspector",[["inspector-tab-info",e.info.root,"Info"],["inspector-tab-peers",e.peers.root,"Peers"],["inspector-tab-tiers",e.tiers.root,"Tiers"],["inspector-tab-files",e.files.root,"Files"]],t.bind(this)),...e}}_setTorrents(e){let t="dataChanged",r=this.torrent_listener;for(let s of this.torrents)s.removeEventListener(t,r);this.torrents=[...e];for(let s of this.torrents)s.addEventListener(t,r);this._refreshTorrents(),this._updateCurrentPage()}static _needsExtraInfo(e){return e.some(t=>!t.hasExtraInfo())}_refreshTorrents(){let{controller:e,torrents:t}=this,r=t.map(s=>s.getId());if(r&&r.length>0){let s=["id",...f.Fields.StatsExtra];o._needsExtraInfo(t)&&s.push(...f.Fields.InfoExtra),e.updateTorrents(r,s)}}_updateCurrentPage(){let{current_page:e,elements:t}=this;switch(e){case t.files.root:this._updateFiles();break;case t.info.root:this._updateInfo();break;case t.peers.root:this._updatePeers();break;case t.tiers.root:this._updateTiers();break;default:console.warn("unexpected page"),console.log(e)}}_updateInfo(){let e="None",t="Mixed",r="Unknown",s=v,i=Date.now(),{elements:n,torrents:l}=this,a=l.reduce((p,b)=>p+b.getSizeWhenDone(),0),c=null,g=!1,u=l.length>=2?t:e;if(l.length===1&&(c=l[0].getName(),g=!0),n.info.name!==document.activeElement&&(n.info.name.value=c),n.info.name.placeholder=u,n.info.name.disabled=!g,l.length===0?(c=null,g=!1):(c=l[0].getLabels().join(", "),g=!0),n.info.labels!==document.activeElement&&(n.info.labels.value=c),n.info.labels.placeholder=e,n.info.labels.disabled=!g,c=null,g=!1,u=e,l.length>0){let p=I=>I.getDownloadDir(),b=p(l[0]);l.every(I=>p(I)===b)?(c=b,g=!0):u=t}if(n.info.location!==document.activeElement&&(n.info.location.value=c),n.info.location.placeholder=u,n.info.location.disabled=!g,c=null,l.length===0)c=e;else if(l.every(p=>p.isFinished()))c="Finished";else if(l.every(p=>p.isStopped()))c="Paused";else{let p=I=>I.getStateString(),b=p(l[0]);c=l.every(I=>p(I)===b)?b:t}h(n.info.state,c);let d=c;if(l.length===0)c=e;else{let p=l.reduce((y,G)=>y+G.getHaveValid(),0),b=l.reduce((y,G)=>y+G.getHaveUnchecked(),0),I=l.reduce((y,G)=>y+G.getLeftUntilDone(),0),A=100*(a?(a-I)/a:1);c=s.percentString(A,1),b?c=`${s.size(p)} of ${s.size(a)} (${c}%), ${s.size(b)} Unverified`:I?c=`${s.size(p)} of ${s.size(a)} (${c}%)`:c=`${s.size(p)} (100%)`}if(h(n.info.have,s.stringSanitizer(c)),l.length===0)c=e;else if(a===0)c=e;else{let p=l.reduce((b,I)=>I.getHave()+I.getDesiredAvailable(),0);c=`${s.percentString(100*p/a,1)}%`}if(h(n.info.availability,s.stringSanitizer(c)),l.length===0)c=e;else{let p=l.reduce((I,A)=>I+A.getDownloadedEver(),0),b=l.reduce((I,A)=>I+A.getFailedEver(),0);c=b?`${s.size(p)} (+${s.size(b)} discarded after failed checksum)`:s.size(p)}if(h(n.info.downloaded,s.stringSanitizer(c)),l.length===0)c=e;else{let p=l.reduce((I,A)=>I+A.getUploadedEver(),0),b=l.reduce((I,A)=>I+A.getSizeWhenDone(),0)||l.reduce((I,A)=>I+A.getHaveValid(),0);c=`${s.size(p)} (Ratio: ${s.ratioString(te.ratio(p,b))})`}if(h(n.info.uploaded,c),l.length===0)c=e;else if(l.every(p=>p.isStopped()))c=d;else{let p=I=>I.getStartDate(),b=p(l[0]);c=l.every(I=>p(I)===b)?s.timeInterval(i/1e3-b):t}if(h(n.info.running_time,c),l.length===0)c=e;else{let p=I=>I.getETA(),b=p(l[0]);l.every(I=>p(I)===b)?b<0?c=r:c=s.timeInterval(b):c=t}if(h(n.info.remaining_time,c),l.length===0)c=e;else{let p=l.reduce((I,A)=>Math.max(I,A.getLastActivity()),-1),b=Math.floor(i/1e3);if(0<p&&p<=b){let I=b-p;c=I<5?"Active now":`${s.timeInterval(I)} ago`}else c=e}if(h(n.info.last_activity,c),l.length===0)c=e;else{let p=I=>I.getErrorString(),b=p(l[0]);c=l.every(I=>p(I)===b)?b:t}if(h(n.info.error,c||e),l.length===1?c=l[0].getName():c=l.length>0?t:e,h(n.info.name,c),l.length===0)c=e;else{let p=l.reduce((b,I)=>b+I.getTotalSize(),0);if(p){let b=G=>G.getPieceSize(),I=l.reduce((G,B)=>G+B.getPieceCount(),0),A=s.number(I),y=b(l[0]);c=l.every(G=>b(G)===y)?`${s.size(p)} (${A} pieces @ ${s.mem(y)})`:`${s.size(p)} (${A} pieces)`}else c="None"}if(h(n.info.size,s.stringSanitizer(c)),l.length===0)c=e;else{let p=I=>I.getHashString(),b=p(l[0]);c=l.every(I=>p(I)===b)?b:t}if(h(n.info.hash,c),l.length===0)c=e;else{let p=I=>I.getPrivateFlag(),b=p(l[0]);l.every(I=>p(I)===b)?b?c="Private to this tracker -- DHT and PEX disabled":c="Public torrent":c=t}if(h(n.info.privacy,c),l.length===0)c=e;else{let p=I=>I.getComment(),b=p(l[0]);c=l.every(I=>p(I)===b)?b:t}if(c=c||e,c.startsWith("https://")||c.startsWith("http://")?(c=encodeURI(c),n.info.comment.innerHTML=`<a href="${c}" target="_blank" >${c}</a>`):h(n.info.comment,c),l.length===0)c=e;else{let p=C=>C.getCreator(),b=p(l[0]),I=!l.every(C=>p(C)===b);p=C=>C.getDateCreated();let A=p(l[0]),y=!l.every(C=>p(C)===A),G=!b||b.length===0,B=!A;I||y?c=t:G&&B?c=r:B&&!G?c=`Created by ${b}`:G&&!B?c=`Created on ${new Date(A*1e3).toDateString()}`:c=`Created by ${b} on ${new Date(A*1e3).toDateString()}`}if(h(n.info.origin,c),l.length===0)c=e;else{let p=I=>I.getDateAdded(),b=p(l[0]);c=l.every(I=>p(I)===b)?new Date(b*1e3).toLocaleString(navigator.language,{day:"2-digit",hour:"2-digit",hour12:!1,minute:"2-digit",month:"short",second:"2-digit",timeZoneName:"short",weekday:"short",year:"numeric"}):t}if(h(n.info.dateAdded,c),l.length===0)h(n.info.magnetLink,e);else if(l.length>1)h(n.info.magnetLink,t);else{let p=l[0].getMagnetLink();n.info.magnetLink.innerHTML=`<a class="inspector-info-magnet" href="${p}"><button></button></a>`}}static _peerStatusTitle(e){let t=Object.seal({"?":"We unchoked this peer, but they're not interested",D:"Downloading from this peer",E:"Encrypted Connection",H:"Peer was discovered through Distributed Hash Table (DHT)",I:"Peer is an incoming connection",K:"Peer has unchoked us, but we're not interested",O:"Optimistic unchoke",T:"Peer is connected via uTP",U:"Uploading to peer",X:"Peer was discovered through Peer Exchange (PEX)",d:"We would download from this peer if they'd let us",u:"We would upload to this peer if they'd ask"});return[...e].filter(r=>t[r]).map(r=>`${r}: ${t[r]}`).join(`
`)}_updatePeers(){let e=v,{elements:t,torrents:r}=this,{tbody:s}=t.peers,i=[(l,a)=>{a.dataset.encrypted=l.isEncrypted},(l,a)=>h(a,l.rateToPeer?e.speedBps(l.rateToPeer):""),(l,a)=>h(a,l.rateToClient?e.speedBps(l.rateToClient):""),(l,a)=>h(a,`${Math.floor(l.progress*100)}%`),(l,a)=>{h(a,l.flagStr),a.setAttribute("title",o._peerStatusTitle(l.flagStr))},(l,a)=>{h(a,l.address),a.setAttribute("title",l.address)},(l,a)=>{h(a,l.clientName),a.setAttribute("title",l.clientName)}],n=[];for(let l of r){let a=document.createElement("tr");a.classList.add("torrent-row");let c=document.createElement("td");c.setAttribute("colspan",i.length),h(c,l.getName()),a.append(c),n.push(a);for(let g of l.getPeers()){let u=document.createElement("tr");u.classList.add("peer-row");for(let[d,p]of i.entries()){let b=document.createElement("td");b.classList.add(Ut[d]),p(g,b),u.append(b)}n.push(u)}for(;s.firstChild;)s.firstChild.remove();s.append(...n)}}static getAnnounceState(e){switch(e.announceState){case f._TrackerActive:return"Announce in progress";case f._TrackerWaiting:{let t=Math.max(0,e.nextAnnounceTime-Date.now()/1e3);return`Next announce in ${v.timeInterval(t)}`}case f._TrackerQueued:return"Announce is queued";case f._TrackerInactive:return e.isBackup?"Tracker will be used as a backup":"Announce not scheduled";default:return`unknown announce state: ${e.announceState}`}}static lastAnnounceStatus(e){let t="Last Announce",r=["N/A"];if(e.hasAnnounced){let s=v.timestamp(e.lastAnnounceTime);e.lastAnnounceSucceeded?r=[s," (got ",v.countString("peer","peers",e.lastAnnouncePeerCount),")"]:(t="Announce error",r=[e.lastAnnounceResult?`${e.lastAnnounceResult} - `:"",s])}return{label:t,value:r.join("")}}static lastScrapeStatus(e){let t="Last Scrape",r="N/A";if(e.hasScraped){let s=v.timestamp(e.lastScrapeTime);e.lastScrapeSucceeded?r=s:(t="Scrape error",r=(e.lastScrapeResult?`${e.lastScrapeResult} - `:"")+s)}return{label:t,value:r}}static _getOrigin(e){try{let t="udp://";if(e.announce.startsWith(t)){let s="http://",i=e.announce.replace(t,s);return new URL(i).origin.replace(s,t)}return new URL(e.announce).origin}catch{return[e.sitename||e.host||e.announce]}}_updateTiers(){let e="N/A",{list:t}=this.elements.tiers,{torrents:r}=this,s=[];for(let i of r){if(r.length>1){let n=document.createElement("div");n.classList.add("tier-list-torrent"),h(n,i.getName()),s.push(n)}for(let n of i.getTrackers()){let l=o.getAnnounceState(n),a=o.lastAnnounceStatus(n),c=o.lastScrapeStatus(n),g=document.createElement("div");g.classList.add("tier-list-row");let u=document.createElement("div"),d=o._getOrigin(n);u.classList.add("tier-list-tracker"),h(u,`${d} - tier ${n.tier+1}`),u.setAttribute("title",n.announce),g.append(u),u=document.createElement("div"),u.classList.add("tier-announce"),h(u,`${a.label}: ${a.value}`),g.append(u),u=document.createElement("div"),u.classList.add("tier-seeders"),h(u,`Seeders: ${n.seederCount>-1?n.seederCount:e}`),g.append(u),u=document.createElement("div"),u.classList.add("tier-state"),h(u,l),g.append(u),u=document.createElement("div"),u.classList.add("tier-leechers"),h(u,`Leechers: ${n.leecherCount>-1?n.leecherCount:e}`),g.append(u),u=document.createElement("div"),u.classList.add("tier-scrape"),h(u,`${c.label}: ${c.value}`),g.append(u),u=document.createElement("div"),u.classList.add("tier-downloads"),h(u,`Downloads: ${n.downloadCount>-1?n.downloadCount:e}`),g.append(u),s.push(g)}}for(;t.firstChild;)t.firstChild.remove();t.append(...s)}_changeFileCommand(e,t){let{controller:r,file_torrent:s}=this,i=s.getId();r.changeFileCommand(i,e,t)}_onFileWantedToggled(e){let{indices:t,wanted:r}=e;this._changeFileCommand(t,r?"files-wanted":"files-unwanted")}_onFilePriorityToggled(e){let{indices:t,priority:r}=e,s=null;switch(r.toString()){case"-1":s="priority-low";break;case"1":s="priority-high";break;default:s="priority-normal"}this._changeFileCommand(t,s)}_clearFileList(){let{list:e}=this.elements.files;for(;e.firstChild;)e.firstChild.remove();this.file_torrent=null,this.file_torrent_n=null,this.file_rows=null}static createFileTreeModel(e){let t=[],r={children:{},file_indices:[]};for(let[s,i]of e.getFiles().entries()){let{name:n}=i,l=n.split("/"),a=r;for(let[c,g]of l.entries()){let u=a.children[g];u||(a.children[g]=u={children:{},depth:c,file_indices:[],name:g,parent:a}),a=u}a.file_index=s,delete a.children,t.push(a)}for(let s of t){let{file_index:i}=s,n=s;do n.file_indices.push(i),n=n.parent;while(n)}return r}addNodeToView(e,t,r){let s=new ye(e,r.depth,r.name,r.file_indices);s.addEventListener("wantedToggled",this._onFileWantedToggled.bind(this)),s.addEventListener("priorityToggled",this._onFilePriorityToggled.bind(this)),this.file_rows.push(s),t.append(s.getElement())}addSubtreeToView(e,t,r){if(r.parent&&this.addNodeToView(e,t,r),r.children)for(let s of Object.values(r.children))this.addSubtreeToView(e,t,s)}_updateFiles(){let{list:e}=this.elements.files,{file_rows:t,file_torrent:r,file_torrent_n:s,torrents:i}=this;if(i.length!==1){this._clearFileList();return}let[n]=i,l=n.getFiles().length;if(n!==r||l!==s){this._clearFileList(),this.file_torrent=n,this.file_torrent_n=l,this.file_rows=[];let a=document.createDocumentFragment(),c=o.createFileTreeModel(n);this.addSubtreeToView(n,a,c),e.append(a)}else for(let a of t)a.refresh()}};var xe=class o extends EventTarget{constructor(e,t,r){super(),this.controller=e,this.remote=t,this.action_input_value=r,this.elements={},this.torrents=[],this.show()}show(){let e=this.controller.getSelectedTorrents();e.length!==0&&(this.torrents=e,this.elements=o._create(this.action_input_value===null?"Apply":"Confirm"),this.elements.confirm.addEventListener("click",()=>this._onConfirm()),this.elements.dismiss.addEventListener("click",()=>this._onDismiss()),this.elements.entry.value=this.action_input_value===null?default_path:this.action_input_value,document.body.append(this.elements.root),this.elements.entry.focus())}close(){this.elements.root.remove(),this.dispatchEvent(new Event("close")),delete this.controller,delete this.remote,delete this.elements,delete this.torrents}_onDismiss(){this.action_input_value===null?this.close():this.controller.action_manager.click("show-inspector")}_onConfirm(){let e=this.torrents.map(r=>r.getId()),t=this.elements.entry.value.trim();this.remote.moveTorrents(e,t),this._onDismiss()}static _create(e){let t=W("move-dialog");t.root.setAttribute("aria-label","Move Torrent"),t.heading.textContent="Set Torrent Location",t.confirm.textContent=e;let r=document.createElement("label");r.setAttribute("for","torrent-path"),r.textContent="Location:",t.workarea.append(r);let s=document.createElement("input");return s.setAttribute("type","text"),s.id="torrent-path",t.entry=s,t.workarea.append(s),t}};var H=class o extends EventTarget{constructor(e){super(),this.elements=o._create(e),this.elements.dismiss.addEventListener("click",()=>this._onDismiss()),this.options=e,document.body.append(this.elements.root),this.elements.dismiss.focus()}close(){if(!this.closed){this.elements.root.remove(),this.dispatchEvent(new Event("close"));for(let e of Object.keys(this))delete this[e];this.closed=!0}}_onDismiss(){this.close()}static _create(e){let{heading:t,message:r}=e,s=W("confirm-dialog");return s.confirm.remove(),delete s.confirm,s.heading.textContent=t,s.workarea.textContent=r,s}};var M=class extends EventTarget{constructor(e,t,r="",s=null){super(),this.controller=e,this.remote=t,this.elements=this._create(r),this.elements.dismiss.addEventListener("click",()=>this._onDismiss()),this.elements.confirm.addEventListener("click",()=>this._onConfirm()),document.body.append(this.elements.root),s&&(this.elements.file_input.files=s),this._updateFreeSpaceInAddDialog(),this.elements.url_input.focus()}close(){if(!this.closed){clearInterval(this.interval),this.elements.root.remove(),this.dispatchEvent(new Event("close"));for(let e of Object.keys(this))delete this[e];this.closed=!0}}_onDismiss(){this.close()}_updateFreeSpaceInAddDialog(){let e=this.elements.folder_input.value;this.remote.getFreeSpace(e,(t,r)=>{this.closed||(this.elements.freespace.textContent=r>0?`${v.size(r)} Free`:"")})}_onConfirm(){let{controller:e,elements:t,remote:r}=this,{file_input:s,folder_input:i,start_input:n,url_input:l}=t,a=!n.checked,c=i.value.trim();for(let u of s.files){let d=new FileReader;d.addEventListener("load",p=>{let b=p.target.result,I="base64,",A=b.indexOf(I);if(A===-1)return;let y={arguments:{"download-dir":c,metainfo:b.slice(Math.max(0,A+I.length)),paused:a},method:"torrent-add"};r.sendRequest(y,G=>{G.result!=="success"&&(alert(`Error adding "${u.name}": ${G.result}`),e.setCurrentPopup(new H({heading:`Error adding "${u.name}"`,message:G.result})))})}),d.readAsDataURL(u)}let g=l.value.trim();if(g.length>0){/^[\da-f]{40}$/i.test(g)&&(g=`magnet:?xt=urn:btih:${g}`);let u={arguments:{"download-dir":c,filename:g,paused:a},method:"torrent-add"};r.sendRequest(u,d=>{d.result!=="success"&&e.setCurrentPopup(new H({heading:`Error adding "${g}"`,message:d.result}))})}this._onDismiss()}_create(e){let t=W(),{confirm:r,root:s,heading:i,workarea:n}=t;s.classList.add("open-torrent"),i.textContent="Add Torrents",r.textContent="Add";let l=F(),a=document.createElement("label");a.setAttribute("for",l),a.textContent="Please select torrent files to add:",n.append(a);let c=document.createElement("input");c.type="file",c.name="torrent-files[]",c.id=l,c.multiple=!0,n.append(c),t.file_input=c,l=F(),a=document.createElement("label"),a.setAttribute("for",l),a.textContent="Or enter a URL:",n.append(a),c=document.createElement("input"),c.type="url",c.id=l,c.value=e,n.append(c),t.url_input=c,l=F(),a=document.createElement("label"),a.id="add-dialog-folder-label",a.for=l,a.textContent="Destination folder: ",n.append(a);let g=document.createElement("span");g.id="free-space-text",a.append(g),n.append(a),t.freespace=g,c=document.createElement("input"),c.type="text",c.id="add-dialog-folder-input",c.addEventListener("change",()=>this._updateFreeSpaceInAddDialog()),c.value=this.controller.session_properties["download-dir"],n.append(c),t.folder_input=c;let u=document.createElement("div");n.append(u);let d=document.createElement("input");return d.type="checkbox",d.id="auto-start-check",d.checked=this.controller.shouldAddedTorrentsStart(),u.append(d),t.start_input=d,a=document.createElement("label"),a.id="auto-start-label",a.setAttribute("for",d.id),a.textContent="Start when added",u.append(a),t}};var Z={_DaemonVersion:"version",_DownSpeedLimit:"speed-limit-down",_DownSpeedLimited:"speed-limit-down-enabled",_QueueMoveBottom:"queue-move-bottom",_QueueMoveDown:"queue-move-down",_QueueMoveTop:"queue-move-top",_QueueMoveUp:"queue-move-up",_Root:"../rpc",_TurtleDownSpeedLimit:"alt-speed-down",_TurtleState:"alt-speed-enabled",_TurtleUpSpeedLimit:"alt-speed-up",_UpSpeedLimit:"speed-limit-up",_UpSpeedLimited:"speed-limit-up-enabled"},oe=class o{constructor(e){this._connection_alert=null,this._controller=e,this._session_id=""}sendRequest(e,t,r){let s=new Headers;s.append("cache-control","no-cache"),s.append("content-type","application/json"),s.append("pragma","no-cache"),this._session_id&&s.append(o._SessionHeader,this._session_id);let i=null;fetch(Z._Root,{body:JSON.stringify(e),headers:s,method:"POST"}).then(n=>{if(i=n,n.status===409){let l=new Error(o._SessionHeader);throw l.header=n.headers.get(o._SessionHeader),l}return n.json()}).then(n=>{t&&t.call(r,n,i),this._connection_alert&&(this._connection_alert.close(),this._connection_alert=null)}).catch(n=>{if(n.message===o._SessionHeader){this._session_id=n.header,this.sendRequest(e,t,r);return}console.trace(n),this._controller.togglePeriodicSessionRefresh(!1),this._connection_alert=new H({heading:"Connection failed",message:"Could not connect to the server. You may need to reload the page to reconnect."}),this._controller.setCurrentPopup(this._connection_alert)})}loadDaemonPrefs(e,t){let r={method:"session-get"};this.sendRequest(r,e,t)}checkPort(e,t,r){let s={arguments:{ipProtocol:e},method:"port-test"};this.sendRequest(s,t,r)}renameTorrent(e,t,r,s,i){let n={arguments:{ids:e,name:r,path:t},method:"torrent-rename-path"};this.sendRequest(n,s,i)}setLabels(e,t,r){let s={ids:e,labels:t};this.sendRequest({arguments:s,method:"torrent-set"},r)}loadDaemonStats(e,t){let r={method:"session-stats"};this.sendRequest(r,e,t)}updateTorrents(e,t,r,s){let i={arguments:{fields:t,format:"table"},method:"torrent-get"};e&&(i.arguments.ids=e),this.sendRequest(i,n=>{let l=n.arguments;r.call(s,l.torrents,l.removed)})}getFreeSpace(e,t,r){let s={arguments:{path:e},method:"free-space"};this.sendRequest(s,i=>{let n=i.arguments;t.call(r,n.path,n["size-bytes"])})}changeFileCommand(e,t,r){let s={ids:[e]};s[r]=t,this.sendRequest({arguments:s,method:"torrent-set"},()=>{this._controller.refreshTorrents([e])})}sendTorrentSetRequests(e,t,r,s,i){r||(r={}),r.ids=t;let n={arguments:r,method:e};this.sendRequest(n,s,i)}sendTorrentActionRequests(e,t,r,s){this.sendTorrentSetRequests(e,t,null,r,s)}startTorrents(e,t,r,s){let i=t?"torrent-start-now":"torrent-start";this.sendTorrentActionRequests(i,e,r,s)}stopTorrents(e,t,r){this.sendTorrentActionRequests("torrent-stop",e,t,r)}moveTorrents(e,t,r,s){this.sendTorrentSetRequests("torrent-set-location",e,{location:t,move:!0},r,s)}removeTorrents(e,t){let r={arguments:{"delete-local-data":t,ids:[]},method:"torrent-remove"};if(e)for(let s=0,i=e.length;s<i;++s)r.arguments.ids.push(e[s].getId());this.sendRequest(r,()=>{this._controller.refreshTorrents()})}verifyTorrents(e,t,r){this.sendTorrentActionRequests("torrent-verify",e,t,r)}reannounceTorrents(e,t,r){this.sendTorrentActionRequests("torrent-reannounce",e,t,r)}addTorrentByUrl(e,t){/^[\da-f]{40}$/i.test(e)&&(e=`magnet:?xt=urn:btih:${e}`);let r={arguments:{filename:e,paused:t.paused},method:"torrent-add"};this.sendRequest(r,()=>{this._controller.refreshTorrents()})}savePrefs(e){let t={arguments:e,method:"session-set"};this.sendRequest(t,()=>{this._controller.loadDaemonPrefs()})}updateBlocklist(){let e={method:"blocklist-update"};this.sendRequest(e,()=>{this._controller.loadDaemonPrefs()})}moveTorrentsToTop(e,t,r){this.sendTorrentActionRequests(Z._QueueMoveTop,e,t,r)}moveTorrentsToBottom(e,t,r){this.sendTorrentActionRequests(Z._QueueMoveBottom,e,t,r)}moveTorrentsUp(e,t,r){this.sendTorrentActionRequests(Z._QueueMoveUp,e,t,r)}moveTorrentsDown(e,t,r){this.sendTorrentActionRequests(Z._QueueMoveDown,e,t,r)}};oe._SessionHeader="X-Transmission-Session-Id";function ve(o,e){let t=document.createElement("fieldset");t.classList.add("section",o);let r=document.createElement("legend");return r.classList.add("title"),r.textContent=e,t.append(r),t}function kt(o,e,t,r){let s=document.createElement("button");return s.textContent=e,s.addEventListener("click",r),o.append(s),s.dataset.action=t,s}var se=class extends EventTarget{constructor(e,t,r,s){super(),this.action_listener=this._onActionChange.bind(this),this.action_manager=s,this.action_manager.addEventListener("change",this.action_listener),this.prefs_listener=this._onPrefsChange.bind(this),this.prefs=t,this.prefs.addEventListener("change",this.prefs_listener),this.closed=!1,this.remote=r,this.name="overflow-menu",this.session_listener=this._onSessionChange.bind(this),this.session_manager=e,this.session_manager.addEventListener("session-change",this.session_listener);let{session_properties:i}=e;Object.assign(this,this._create(i)),this.outside=new N(this.root),this.outside.addEventListener("click",()=>this.close()),Object.seal(this),this.show()}show(){document.body.append(this.root)}close(){if(!this.closed){this.outside.stop(),this.session_manager.removeEventListener("session-change",this.session_listener),this.action_manager.removeEventListener("change",this.action_listener),this.prefs.removeEventListener("change",this.prefs_listener),this.root.remove(),this.dispatchEvent(new Event("close"));for(let e of Object.keys(this))this[e]=null;this.closed=!0}}_onSessionChange(e){let{alt_speed_check:t}=this.elements,{session_properties:r}=e;t.checked=r[Z._TurtleState]}_onPrefsChange(e){switch(e.key){case m.SortDirection:case m.SortMode:this.root.querySelector(`[data-pref="${e.key}"]`).value=e.value;break;default:break}}_onActionChange(e){let t=this.actions[e.action];t&&this._updateElement(t)}_updateElement(e){if(e.dataset.action){let{action:t}=e.dataset,r=this.action_manager.keyshortcuts(t);r&&e.setAttribute("aria-keyshortcuts",r),w(e,this.action_manager.isEnabled(t))}}_onClick(e){let{action:t,pref:r}=e.target.dataset;if(t){this.action_manager.click(t);return}if(r){this.prefs[r]=e.target.value;return}console.log("unhandled"),console.log(e),console.trace()}_create(e){let t={},r={},s=this._onClick.bind(this),i=document.createElement("div");i.classList.add("overflow-menu","popup");let n=ve("display","Display");i.append(n);let l=document.createElement("div");l.id="display-options",n.append(l);let a=document.createElement("div");a.classList.add("table-row"),l.append(a);let c=document.createElement("label");c.id="display-sort-mode-label",c.textContent="Sort by",a.append(c);let g=document.createElement("select");g.id="display-sort-mode-select",g.dataset.pref=m.SortMode,a.append(g);let u=[[m.SortByActivity,"Activity"],[m.SortByAge,"Age"],[m.SortByName,"Name"],[m.SortByProgress,"Progress"],[m.SortByQueue,"Queue order"],[m.SortByRatio,"Ratio"],[m.SortBySize,"Size"],[m.SortByState,"State"]];for(let[C,x]of u){let Q=document.createElement("option");Q.value=C,Q.textContent=x,g.append(Q)}c.setAttribute("for",g.id),g.value=this.prefs.sort_mode,g.addEventListener("change",C=>{this.prefs.sort_mode=C.target.value}),a=document.createElement("div"),a.classList.add("table-row"),l.append(a);let d=document.createElement("input");d.id="display-sort-reverse-check",d.dataset.pref=m.SortDirection,d.type="checkbox",a.append(d),c=document.createElement("label"),c.id="display-sort-reverse-label",c.setAttribute("for",d.id),c.textContent="Reverse sort",a.append(c),d.checked=this.prefs.sort_direction!==m.SortAscending,d.addEventListener("input",C=>{this.prefs.sort_direction=C.target.checked?m.SortDescending:m.SortAscending}),a=document.createElement("div"),a.classList.add("table-row"),l.append(a);let p="toggle-compact-rows";d=document.createElement("input"),d.id="display-compact-check",d.dataset.action=p,d.type="checkbox",a.append(d),c=document.createElement("label"),c.id="display-compact-label",c.for=d.id,c.setAttribute("for",d.id),c.textContent=this.action_manager.text(p),d.checked=this.prefs.display_mode===m.DisplayCompact,a.append(c),d.addEventListener("input",C=>{let{checked:x}=C.target;this.prefs.display_mode=x?m.DisplayCompact:m.DisplayFull}),a=document.createElement("div"),a.classList.add("table-row"),l.append(a),p="toggle-contrast",d=document.createElement("input"),d.id="contrast-more-check",d.dataset.action=p,d.type="checkbox",d.classList.add("switch"),c=document.createElement("label"),c.id="contrast-more-label",c.for=d.id,c.setAttribute("for",d.id),c.textContent=this.action_manager.text(p),d.checked=this.prefs.contrast_mode===m.ContrastMore,a.append(d),a.append(c),d.addEventListener("input",C=>{let{checked:x}=C.target;this.prefs.contrast_mode=x?m.ContrastMore:m.ContrastLess}),a=document.createElement("div"),a.classList.add("table-row","display-fullscreen-row"),l.append(a),d=document.createElement("input"),d.id="display-fullscreen-check",d.type="checkbox";let b=()=>document.fullscreenElement!==null;d.checked=b(),d.addEventListener("input",()=>{b()?document.exitFullscreen():document.body.requestFullscreen()}),document.addEventListener("fullscreenchange",()=>{d.checked=b()}),a.append(d),c=document.createElement("label"),c.id="display-fullscreen-label",c.for=d.id,c.setAttribute("for",d.id),c.textContent="Fullscreen",a.append(c),n=ve("speed","Speed Limit"),i.append(n),l=document.createElement("div"),l.id="speed-options",n.append(l),a=document.createElement("div"),a.classList.add("speed-up"),l.append(a),c=document.createElement("label"),c.id="speed-up-label",c.textContent="Upload:",a.append(c);let I="Unlimited";g=document.createElement("select"),g.id="speed-up-select",a.append(g);let A=["50","100","250","500","1000","2500","5000","10000",I];for(let C of[...new Set(A).add(`${e[Z._UpSpeedLimit]}`).values()].sort((x,Q)=>x-Q)){let x=document.createElement("option");x.value=C,x.textContent=C===I?I:v.speed(C),g.append(x)}c.setAttribute("for",g.id),g.value=e[Z._UpSpeedLimited]?`${e[Z._UpSpeedLimit]}`:I,g.addEventListener("change",C=>{let{value:x}=C.target;console.log(C),x===I?this.remote.savePrefs({[Z._UpSpeedLimited]:!1}):this.remote.savePrefs({[Z._UpSpeedLimited]:!0,[Z._UpSpeedLimit]:Number.parseInt(x,10)})}),a=document.createElement("div"),a.classList.add("speed-down"),l.append(a),c=document.createElement("label"),c.id="speed-down-label",c.textContent="Download:",a.append(c),g=document.createElement("select"),g.id="speed-down-select",a.append(g);for(let C of[...new Set(A).add(`${e[Z._DownSpeedLimit]}`).values()].sort((x,Q)=>x-Q)){let x=document.createElement("option");x.value=C,x.textContent=C===I?I:v.speed(C),g.append(x)}c.setAttribute("for",g.id),g.value=e[Z._DownSpeedLimited]?`${e[Z._DownSpeedLimit]}`:I,g.addEventListener("change",C=>{let{value:x}=C.target;console.log(C),x===I?this.remote.savePrefs({[Z._DownSpeedLimited]:!1}):this.remote.savePrefs({[Z._DownSpeedLimited]:!0,[Z._DownSpeedLimit]:Number.parseInt(x,10)})}),a=document.createElement("div"),a.classList.add("alt-speed"),l.append(a),d=document.createElement("input"),d.id="alt-speed-check",d.type="checkbox",d.checked=e[Z._TurtleState],d.addEventListener("change",C=>{this.remote.savePrefs({[Z._TurtleState]:C.target.checked})}),a.append(d),r.alt_speed_check=d,c=document.createElement("label"),c.id="alt-speed-icon",c.setAttribute("for",d.id),a.append(c),c=document.createElement("label"),c.id="alt-speed-label",c.setAttribute("for",d.id),c.textContent="Use Temp limits",a.append(c),c=document.createElement("label"),c.id="alt-speed-values-label",c.setAttribute("for",d.id);let y=v.speed(e[Z._TurtleUpSpeedLimit]),G=v.speed(e[Z._TurtleDownSpeedLimit]);c.textContent=`(${y} up, ${G} down)`,a.append(c),n=ve("actions","Actions"),i.append(n);for(let C of["show-preferences-dialog","show-shortcuts-dialog","pause-all-torrents","start-all-torrents"]){let x=this.action_manager.text(C);t[C]=kt(n,x,C,s)}n=ve("help","Help"),i.append(n),l=document.createElement("div"),n.append(l);for(let C of["show-statistics-dialog","show-about-dialog"]){let x=this.action_manager.text(C);t[C]=kt(l,x,C,s)}let B=document.createElement("a");return B.href="https://transmissionbt.com/donate.html",B.target="_blank",B.textContent="Donate",l.append(B),this._updateElement=this._updateElement.bind(this),{actions:t,elements:r,root:i}}};var Ze=class o extends EventTarget{static _initTimeDropDown(e){for(let t=0;t<24*4;++t){let r=t/4,s=t%4*15,i=t*15,n=`${r}:${s||"00"}`;e.options[t]=new Option(n,i)}}static _initDayDropDown(e){let t=[["Everyday","127"],["Weekdays","62"],["Weekends","65"],["Sunday","1"],["Monday","2"],["Tuesday","4"],["Wednesday","8"],["Thursday","16"],["Friday","32"],["Saturday","64"]];for(let r=0;t[r];++r){let[s,i]=t[r];e.options[r]=new Option(s,i)}}_checkPort(){for(let[e,t]of Object.entries(this.elements.network.port_status_label))delete t.dataset.open,h(t,"Checking..."),this.remote.checkPort(e,r=>this._onPortChecked(e,r),this)}_onPortChecked(e,t){if(this.closed)return;let r=this.elements.network.port_status_label[e],s=t.arguments["port-is-open"]||!1;r.dataset.open=s,"port-is-open"in t.arguments?h(r,s?"Open":"Closed"):h(r,"Error")}_setBlocklistButtonEnabled(e){let t=this.elements.peers.blocklist_update_button;w(t,e),t.value=e?"Update":"Updating..."}static _getValue(e){if(e.tagName==="TEXTAREA")return e.value;switch(e.type){case"checkbox":case"radio":return e.checked;case"number":case"select-one":case"text":case"url":{let t=e.value;return Number.parseInt(t,10).toString()===t?Number.parseInt(t,10):Number.parseFloat(t).toString()===t?Number.parseFloat(t):t}default:return null}}_onMaybePortChanged(e){(e==="peer-port"||e==="port-forwarding-enabled")&&this._checkPort()}_onControlChanged(e){let{key:t}=e.target.dataset;this.remote.savePrefs({[t]:o._getValue(e.target)}),this._onMaybePortChanged(t)}_onDialogClosed(){this.dispatchEvent(new Event("closed"))}_update(){this._setBlocklistButtonEnabled(!0);for(let[e,t]of Object.entries(this.session_manager.session_properties))for(let r of this.elements.root.querySelectorAll(`[data-key="${e}"]`))if(e==="blocklist-size"){let s=v.number(t);r.innerHTML=`Blocklist has <span class="blocklist-size-number">${s}</span> rules`,h(this.elements.peers.blocklist_update_button,"Update")}else switch(r.type){case"checkbox":case"radio":r.checked=t;break;case"text":case"textarea":case"url":case"email":case"number":case"search":r!==document.activeElement&&(r.value!=t&&this._onMaybePortChanged(e),r.value=t);break;case"select-one":r.value=t;break;default:console.log(r.type);break}}shouldAddedTorrentsStart(){return this.data.elements.root.find("#start-added-torrents")[0].checked}static _createCheckAndLabel(e,t){let r=document.createElement("div");r.id=e;let s=document.createElement("input");s.id=F(),s.type="checkbox",r.append(s);let i=document.createElement("label");return i.textContent=t,i.setAttribute("for",s.id),r.append(i),{check:s,label:i,root:r}}static _enableIfChecked(e,t){let r=()=>{e.tagName==="INPUT"?w(e,t.checked):e.classList.toggle("disabled",!t.checked)};t.addEventListener("change",r),r()}static _getProtocolHandlerRegistered(){return localStorage.getItem("protocol-handler-registered")==="true"}static _updateProtocolHandlerButton(e){e.removeAttribute("disabled"),e.removeAttribute("title"),o._getProtocolHandlerRegistered()?(e.textContent="Remove Browser Handler","unregisterProtocolHandler"in navigator||e.setAttribute("title","Your browser does not support removing protocol handlers. This button only allows you to re-register a handler.")):(e.textContent="Add Browser Handler",e.removeAttribute("title"),"registerProtocolHandler"in navigator||(e.setAttribute("disabled",!0),e.setAttribute("title","Your browser does not support protocol handlers")))}static _toggleProtocolHandler(e){let t=new URL(window.location.href);t.search="addtorrent=%s",this._getProtocolHandlerRegistered()?(navigator.unregisterProtocolHandler?.("magnet",t.toString()),localStorage.removeItem("protocol-handler-registered"),o._updateProtocolHandlerButton(e)):(navigator.registerProtocolHandler("magnet",t.toString(),"Transmission Web"),localStorage.setItem("protocol-handler-registered","true"),o._updateProtocolHandlerButton(e))}static _createTorrentsPage(){let e=document.createElement("div");e.classList.add("prefs-torrents-page");let t=document.createElement("div");t.textContent="Downloading",t.classList.add("section-label"),e.append(t),t=document.createElement("label"),t.textContent="Download to:",e.append(t);let r=document.createElement("input");r.type="text",r.id=F(),r.dataset.key="download-dir",t.setAttribute("for",r.id),e.append(r);let s=r,i=o._createCheckAndLabel("incomplete-dir-div","Use temporary folder:");i.check.title="Separate folder to temporarily store downloads until they are complete.",i.check.dataset.key="incomplete-dir-enabled",i.label.title=i.check.title,e.append(i.root);let n=i.check;r=document.createElement("input"),r.type="text",r.dataset.key="incomplete-dir",e.append(r),o._enableIfChecked(r,i.check);let l=r;i=o._createCheckAndLabel("autostart-div","Start when added"),i.check.dataset.key="start-added-torrents",e.append(i.root);let a=i.check;i=o._createCheckAndLabel("suffix-div",`Append "part" to incomplete files' names`),i.check.dataset.key="rename-partial-files",e.append(i.root);let c=i.check;i=o._createCheckAndLabel("download-queue-div","Download queue size:"),i.check.dataset.key="download-queue-enabled",e.append(i.root);let g=i.check;r=document.createElement("input"),r.type="number",r.dataset.key="download-queue-size",e.append(r),o._enableIfChecked(r,i.check);let u=r;t=document.createElement("div"),t.textContent="Seeding",t.classList.add("section-label"),e.append(t),i=o._createCheckAndLabel("stop-ratio-div","Stop seeding at ratio:"),i.check.dataset.key="seedRatioLimited",e.append(i.root);let d=i.check;r=document.createElement("input"),r.type="number",r.min="0.1",r.step="any",r.dataset.key="seedRatioLimit",e.append(r),o._enableIfChecked(r,i.check);let p=r;i=o._createCheckAndLabel("stop-idle-div","Stop seeding if idle for N mins:"),i.check.dataset.key="idle-seeding-limit-enabled",e.append(i.root);let b=i.check;r=document.createElement("input"),r.type="number",r.min="0.1",r.step="any",r.dataset.key="idle-seeding-limit",e.append(r),o._enableIfChecked(r,i.check);let I=r;t=document.createElement("div"),t.textContent="Magnet Protocol Handler",t.classList.add("section-label"),e.append(t);let A=document.createElement("button");return A.classList.add("register-handler-button"),o._updateProtocolHandlerButton(A),e.append(A),{autostart_check:a,download_dir:s,download_queue_check:g,download_queue_input:u,incomplete_dir_check:n,incomplete_dir_input:l,register_handler_button:A,root:e,stop_idle_check:b,stop_idle_input:I,stop_ratio_check:d,stop_ratio_input:p,suffix_check:c}}static _createSpeedPage(){let e=document.createElement("div");e.classList.add("prefs-speed-page");let t=document.createElement("div");t.textContent="Speed Limits",t.classList.add("section-label"),e.append(t);let r=o._createCheckAndLabel("upload-speed-div","Upload (kB/s):");r.check.dataset.key="speed-limit-up-enabled",e.append(r.root);let s=r.check,i=document.createElement("input");i.type="number",i.dataset.key="speed-limit-up",e.append(i),o._enableIfChecked(i,r.check);let n=i;r=o._createCheckAndLabel("download-speed-div","Download (kB/s):"),r.check.dataset.key="speed-limit-down-enabled",e.append(r.root);let l=r.check;i=document.createElement("input"),i.type="number",i.dataset.key="speed-limit-down",e.append(i),o._enableIfChecked(i,r.check);let a=i;t=document.createElement("div"),t.textContent="Alternative Speed Limits",t.classList.add("section-label","alt-speed-section-label"),e.append(t),t=document.createElement("div"),t.textContent="Override normal speed limits manually or at scheduled times",t.classList.add("alt-speed-label"),e.append(t),t=document.createElement("label"),t.textContent="Upload (kB/s):",e.append(t),i=document.createElement("input"),i.type="number",i.dataset.key="alt-speed-up",i.id=F(),t.setAttribute("for",i.id),e.append(i);let c=i;t=document.createElement("label"),t.textContent="Download (kB/s):",e.append(t),i=document.createElement("input"),i.type="number",i.dataset.key="alt-speed-down",i.id=F(),t.setAttribute("for",i.id),e.append(i);let g=i;r=o._createCheckAndLabel("alt-times-div","Scheduled times"),r.check.dataset.key="alt-speed-time-enabled",e.append(r.root);let u=r.check;t=document.createElement("label"),t.textContent="From:",o._enableIfChecked(t,r.check),e.append(t);let d=document.createElement("select");d.id=F(),d.dataset.key="alt-speed-time-begin",o._initTimeDropDown(d),t.setAttribute("for",d.id),e.append(d),o._enableIfChecked(d,r.check);let p=d;t=document.createElement("label"),t.textContent="To:",o._enableIfChecked(t,r.check),e.append(t),d=document.createElement("select"),d.id=F(),d.dataset.key="alt-speed-time-end",o._initTimeDropDown(d),t.setAttribute("for",d.id),e.append(d),o._enableIfChecked(d,r.check);let b=d;return t=document.createElement("label"),t.textContent="On days:",o._enableIfChecked(t,r.check),e.append(t),d=document.createElement("select"),d.id=F(),d.dataset.key="alt-speed-time-day",o._initDayDropDown(d),t.setAttribute("for",d.id),e.append(d),o._enableIfChecked(d,r.check),{alt_days_select:d,alt_download_speed_input:g,alt_from_select:p,alt_times_check:u,alt_to_select:b,alt_upload_speed_input:c,download_speed_check:l,download_speed_input:a,root:e,upload_speed_check:s,upload_speed_input:n}}static _createPeersPage(){let e=document.createElement("div");e.classList.add("prefs-peers-page");let t=document.createElement("div");t.textContent="Connections",t.classList.add("section-label"),e.append(t),t=document.createElement("label"),t.textContent="Max peers per torrent:",e.append(t);let r=document.createElement("input");r.type="number",r.dataset.key="peer-limit-per-torrent",r.id=F(),t.setAttribute("for",r.id),e.append(r);let s=r;t=document.createElement("label"),t.textContent="Max peers overall:",e.append(t),r=document.createElement("input"),r.type="number",r.dataset.key="peer-limit-global",r.id=F(),t.setAttribute("for",r.id),e.append(r);let i=r;t=document.createElement("div"),t.textContent="Options",t.classList.add("section-label"),e.append(t),t=document.createElement("label"),t.textContent="Encryption mode:",e.append(t);let n=document.createElement("select");n.id=F(),n.dataset.key="encryption",n.options[0]=new Option("Prefer encryption","preferred"),n.options[1]=new Option("Allow encryption","tolerated"),n.options[2]=new Option("Require encryption","required"),e.append(n);let l=n,a=o._createCheckAndLabel("use-pex-div","Use PEX to find more peers");a.check.title="PEX is a tool for exchanging peer lists with the peers you're connected to.",a.check.dataset.key="pex-enabled",a.label.title=a.check.title,e.append(a.root);let c=a.check;a=o._createCheckAndLabel("use-dht-div","Use DHT to find more peers"),a.check.title="DHT is a tool for finding peers without a tracker.",a.check.dataset.key="dht-enabled",a.label.title=a.check.title,e.append(a.root);let g=a.check;a=o._createCheckAndLabel("use-lpd-div","Use LPD to find more peers"),a.check.title="LPD is a tool for finding peers on your local network.",a.check.dataset.key="lpd-enabled",a.label.title=a.check.title,e.append(a.root);let u=a.check;t=document.createElement("div"),t.textContent="Blocklist",t.classList.add("section-label"),e.append(t),a=o._createCheckAndLabel("blocklist-enabled-div","Enable blocklist:"),a.check.dataset.key="blocklist-enabled",e.append(a.root);let d=a.check;r=document.createElement("input"),r.type="url",r.value="http://www.example.com/blocklist",r.dataset.key="blocklist-url",e.append(r),o._enableIfChecked(r,a.check);let p=r;t=document.createElement("label"),t.textContent="Blocklist has {n} rules",t.dataset.key="blocklist-size",t.classList.add("blocklist-size-label"),o._enableIfChecked(t,a.check),e.append(t);let b=document.createElement("button");return b.classList.add("blocklist-update-button"),b.textContent="Update",e.append(b),o._enableIfChecked(b,a.check),{blocklist_enabled_check:d,blocklist_update_button:b,blocklist_url_input:p,dht_check:g,encryption_select:l,lpd_check:u,max_peers_overall_input:i,max_peers_per_torrent_input:s,pex_check:c,root:e}}static _createNetworkPage(){let e=document.createElement("div");e.classList.add("prefs-network-page");let t=document.createElement("div");t.textContent="Listening Port",t.classList.add("section-label"),e.append(t),t=document.createElement("label"),t.textContent="Peer listening port:",e.append(t);let r=document.createElement("input");r.type="number",r.dataset.key="peer-port",r.id=F(),t.setAttribute("for",r.id),e.append(r);let s=r,i=document.createElement("div");i.classList.add("port-status"),t=document.createElement("label"),t.textContent="IPv4 port is",i.append(t);let n=document.createElement("label");n.textContent="?",n.classList.add("port-status-label"),i.append(n),i.append(document.createElement("br")),t=document.createElement("label"),t.textContent="IPv6 port is",i.append(t);let l=document.createElement("label");l.textContent="?",l.classList.add("port-status-label"),i.append(l),e.append(i);let a=o._createCheckAndLabel("randomize-port","Randomize port on launch");a.check.dataset.key="peer-port-random-on-start",e.append(a.root);let c=a.check;a=o._createCheckAndLabel("port-forwarding","Use port forwarding from my router"),a.check.dataset.key="port-forwarding-enabled",e.append(a.root);let g=a.check;t=document.createElement("div"),t.textContent="Options",t.classList.add("section-label"),e.append(t),a=o._createCheckAndLabel("utp-enabled","Enable uTP for peer communication"),a.check.dataset.key="utp-enabled",e.append(a.root);let u=a.check;t=document.createElement("div"),t.textContent="Default Public Trackers",t.classList.add("section-label"),e.append(t);let d=["Trackers to use on all public torrents.","To add a backup URL, add it on the next line after a primary URL.","To add a new primary URL, add it after a blank line."];for(let I of d)t=document.createElement("label"),t.classList.add("default-trackers-label"),t.textContent=I,t.setAttribute("for","default-trackers"),e.append(t);let p=document.createElement("textarea");return p.dataset.key="default-trackers",p.id="default-trackers",e.append(p),{default_trackers_textarea:p,port_forwarding_check:g,port_input:s,port_status_label:{ipv4:n,ipv6:l},random_port_check:c,root:e,utp_check:u}}static _create(){let e={network:o._createNetworkPage(),peers:o._createPeersPage(),speed:o._createSpeedPage(),torrents:o._createTorrentsPage()};return{...he("prefs-dialog",[["prefs-tab-torrent",e.torrents.root,"Torrents"],["prefs-tab-speed",e.speed.root,"Speed"],["prefs-tab-peers",e.peers.root,"Peers"],["prefs-tab-network",e.network.root,"Network"]]),...e}}constructor(e,t){super(),this.closed=!1,this.session_manager=e,this.remote=t,this.update_from_session=()=>this._update(),this.elements=o._create(),this.elements.peers.blocklist_update_button.addEventListener("click",i=>{h(i.target,"Updating blocklist..."),this.remote.updateBlocklist(),this._setBlocklistButtonEnabled(!1)}),this.elements.torrents.register_handler_button.addEventListener("click",i=>{o._toggleProtocolHandler(i.currentTarget)}),this.elements.dismiss.addEventListener("click",()=>this.close()),this.outside=new N(this.elements.root),this.outside.addEventListener("click",()=>this.close()),Object.seal(this);let r=this._onControlChanged.bind(this),s=i=>{for(let n of Object.values(i))if(n.tagName==="INPUT")switch(n.type){case"checkbox":case"radio":case"number":case"text":case"url":n.addEventListener("change",r);break;default:console.trace(`unhandled input: ${n.type}`);break}else(n.tagName==="TEXTAREA"||n.tagName==="SELECT")&&n.addEventListener("change",r)};s(this.elements.network),s(this.elements.peers),s(this.elements.speed),s(this.elements.torrents),this.session_manager.addEventListener("session-change",this.update_from_session),this.update_from_session(),document.body.append(this.elements.root)}close(){if(!this.closed){this.outside.stop(),this.session_manager.removeEventListener("session-change",this.update_from_session),this.elements.root.remove(),dispatchEvent(new Event("close"));for(let e of Object.keys(this))this[e]=null;this.closed=!0}}};var Xe=class o extends EventTarget{constructor(e){super(),this.options=e,this.options.trash=!1,this.elements=o._create(e),this.elements.dismiss.addEventListener("click",()=>this._onDismiss()),this.elements.confirm.addEventListener("click",()=>this._onConfirm()),document.body.append(this.elements.root),this.elements.dismiss.focus()}close(){if(!this.closed){this.elements.root.remove(),this.dispatchEvent(new Event("close"));for(let e of Object.keys(this))delete this[e];this.closed=!0}}_onDismiss(){this.close()}_onConfirm(){let{remote:e,torrents:t,trash:r}=this.options;t.length>0&&e.removeTorrents(t,r),this.close()}static _create(e){let{torrents:t}=e,r=W("remove-dialog"),{confirm:s,heading:i,message:n,workarea:l}=r;i.textContent=t.length===1?`Remove ${t[0].getName()}?`:`Remove ${t.length} transfers?`;let a=document.createElement("input");a.id="delete-local-data-check",a.type="checkbox",a.checked=!1,n.append(a);let c=document.createElement("label");c.id="delete-local-data-label",c.setAttribute("for",a.id),c.textContent="Delete downloaded data",n.append(c);let g=document.createElement("div"),u=d=>{d&&t.length===1?g.textContent="All data downloaded for this torrent will be deleted. Are you sure you want to remove it?":d?g.textContent="All data downloaded for these torrents will be deleted. Are you sure you want to remove them?":t.length===1?g.textContent="Once removed, continuing the transfer will require the torrent file. Are you sure you want to remove it?":g.textContent="Once removed, continuing the transfers will require the torrent files. Are you sure you want to remove them?",s.textContent=d?"Delete":"Remove"};return u(a.checked),a.addEventListener("click",()=>{e.trash=a.checked,u(a.checked)}),l.append(g),r}};var Fe=class o extends EventTarget{constructor(e,t,r){super(),this.controller=e,this.remote=t,this.action_input_value=r,this.elements={},this.torrents=[],this.show()}show(){let e=this.controller.getSelectedTorrents();if(e.length!==1){console.trace();return}this.torrents=e,this.elements=o._create(this.action_input_value===null?"Rename":"Confirm"),this.elements.dismiss.addEventListener("click",()=>this._onDismiss()),this.elements.confirm.addEventListener("click",()=>this._onConfirm()),this.elements.entry.value=this.action_input_value===null?e[0].getName():this.action_input_value,document.body.append(this.elements.root),this.elements.entry.focus()}close(){this.elements.root.remove(),this.dispatchEvent(new Event("close")),delete this.controller,delete this.remote,delete this.elements,delete this.torrents}_onDismiss(){this.action_input_value===null?this.close():this.controller.action_manager.click("show-inspector")}_onConfirm(){let[e]=this.torrents,t=e.getName(),r=this.elements.entry.value;this.remote.renameTorrent([e.getId()],t,r,s=>{s.result==="success"&&e.refresh(s.arguments)}),this._onDismiss()}static _create(e){let t=W("rename-dialog");t.root.setAttribute("aria-label","Rename Torrent"),t.heading.textContent="Enter new name:",t.confirm.textContent=e;let r=document.createElement("label");r.setAttribute("for","torrent-rename-name"),r.textContent="Enter new name:",t.workarea.append(r);let s=document.createElement("input");return s.setAttribute("type","text"),s.id="torrent-rename-name",t.entry=s,t.workarea.append(s),t}};var We=class o extends EventTarget{constructor(e,t,r){super(),this.controller=e,this.remote=t,this.action_input_value=r,this.elements={},this.torrents=[],this.show()}show(){let e=this.controller.getSelectedTorrents();if(e.length===0){console.error("At least one selected torrent expected.");return}let[t]=e;this.torrents=e,this.elements=o._create(this.action_input_value===null?"Save":"Confirm"),this.elements.dismiss.addEventListener("click",()=>this._onDismiss()),this.elements.confirm.addEventListener("click",()=>this._onConfirm()),this.elements.entry.value=this.action_input_value===null?t.getLabels().join(", "):this.action_input_value,document.body.append(this.elements.root),this.elements.entry.focus()}close(){this.elements.root.remove(),this.dispatchEvent(new Event("close")),delete this.elements,delete this.torrents}_onDismiss(){this.action_input_value===null?this.close():this.controller.action_manager.click("show-inspector")}_onConfirm(){let{torrents:e}=this,{remote:t}=this,r=e.map(a=>a.getId()),{elements:s}=this,{entry:i}=s,{value:n}=i,l=n.split(/ *, */).filter(a=>a.length>0);t.setLabels(r,l,a=>{if(a.result==="success")for(let c of e)c.refresh({labels:l})}),this._onDismiss()}static _create(e){let t=W("labels-dialog");t.root.setAttribute("aria-label","Edit Labels"),t.heading.textContent="Edit Labels:",t.confirm.textContent=e;let r=document.createElement("label");r.setAttribute("for","torrent-labels"),r.textContent="Labels:",t.workarea.append(r);let s=document.createElement("input");return s.setAttribute("type","text"),s.id="torrent-labels",t.entry=s,t.workarea.append(s),t}};var Le=class o extends EventTarget{constructor(e){super(),this.elements=o._create(e),this.elements.dismiss.addEventListener("click",()=>this._onDismiss()),document.body.append(this.elements.root),this.elements.dismiss.focus()}close(){this.elements.root.remove(),this.dispatchEvent(new Event("close")),delete this.elements}_onDismiss(){this.close()}static _create(e){let t=W("shortcuts-dialog");t.root.setAttribute("aria-label","Keyboard Shortcuts");let r=document.createElement("table"),s=document.createElement("thead");r.append(s);let i=document.createElement("tr");s.append(i);let n=document.createElement("th");n.textContent="Key",i.append(n),n=document.createElement("th"),n.textContent="Action",i.append(n);let l=document.createElement("tbody");r.append(l);let a={};for(let[c,g]of e.allShortcuts().entries()){let u=c.split("+"),d=[u.pop(),...u].join("+");a[d]={name:g,shortcut:c}}for(let[,c]of Object.entries(a).sort()){let{name:g,shortcut:u}=c;i=document.createElement("tr"),l.append(i);let d=document.createElement("td");d.textContent=u.replaceAll("+"," + "),i.append(d),d=document.createElement("td"),d.textContent=e.text(g),i.append(d)}return t.heading.textContent="Transmission",t.dismiss.textContent="Close",t.heading.textContent="Keyboard shortcuts",t.message.append(r),t.confirm.remove(),delete t.confirm,t}};var we=class o extends EventTarget{constructor(e){super(),this.remote=e;let t=()=>this.remote.loadDaemonStats(s=>this._update(s.arguments)),r=5e3;this.interval=setInterval(t,r),t(),this.elements=o._create(),this.elements.dismiss.addEventListener("click",()=>this._onDismiss()),document.body.append(this.elements.root),this.elements.dismiss.focus()}close(){if(!this.closed){clearInterval(this.interval),this.elements.root.remove();for(let e of Object.keys(this))delete this[e];this.closed=!0}}_onDismiss(){this.close()}_update(e){console.log(e);let t=v,r=e["current-stats"],s=te.ratio(r.uploadedBytes,r.downloadedBytes);h(this.elements.session.up,t.size(r.uploadedBytes)),h(this.elements.session.down,t.size(r.downloadedBytes)),this.elements.session.ratio.innerHTML=t.ratioString(s),h(this.elements.session.time,t.timeInterval(r.secondsActive)),r=e["cumulative-stats"],s=te.ratio(r.uploadedBytes,r.downloadedBytes),h(this.elements.total.up,t.size(r.uploadedBytes)),h(this.elements.total.down,t.size(r.downloadedBytes)),this.elements.total.ratio.innerHTML=t.ratioString(s),h(this.elements.total.time,t.timeInterval(r.secondsActive))}static _create(){let e=W("statistics-dialog"),{confirm:t,dismiss:r,heading:s,root:i,workarea:n}=e;t.remove(),r.textContent="Close",delete e.confirm;let l="Statistics";i.setAttribute("aria-label",l),s.textContent=l;let a=["Uploaded:","Downloaded:","Ratio:","Running time:"],c=ze("Current session",a),[g,u,d,p]=c.children,b=e.session={};b.up=g,b.down=u,b.ratio=d,b.time=p,n.append(c.root),c=ze("Total",a);let[I,A,y,G]=c.children,B=e.total={};return B.up=I,B.down=A,B.ratio=y,B.time=G,n.append(c.root),e}};var L={formatETA:o=>{let e=o.getETA();return e<0||e>=999*60*60?"":`ETA: ${v.timeInterval(e,1)}`},formatLabels:(o,e)=>{let t=o.getLabels();e.innerHTML="";for(let r of t){let s=document.createElement("span");s.classList.add("torrent-label"),s.textContent=r,e.append(s)}},getProgressInfo:(o,e)=>{let t=e.getStatus(),r=["torrent-progress-bar"],s=100,i=null;if(t===f._StatusStopped&&r.push("paused"),e.needsMetaData())r.push("magnet"),s=e.getMetadataPercentComplete()*100;else if(t===f._StatusCheck)r.push("verify"),s=e.getRecheckProgress()*100;else if(e.getLeftUntilDone()>0)r.push("leech"),s=e.getPercentDone()*100;else if(r.push("seed"),t!==f._StatusStopped){let n=e.seedRatioLimit(o);i=n>0?e.getUploadRatio()*100/n:100}return e.isQueued()&&r.push("queued"),{classList:r,percent:s,ratio:i}},renderProgressbar:(o,e,t)=>{let r=L.getProgressInfo(o,e),s=Math.min(r.ratio||r.percent,100),i=`${v.percentString(s,2)}%`;t.className=r.classList.join(" "),t.style.setProperty("--progress",i),t.dataset.progress=r.ratio?"100%":i},renderSelectIcon:(o,e)=>{let t=document.createElement("input");t.type="checkbox",t.checked=!0;let r=document.createElement("icon");r.className="icon",r.dataset.iconMimeType=e.getPrimaryMimeType().split("/",1).pop(),r.dataset.iconMultifile=e.getFileCount()>1?"true":"false",o.append(t,r)},symbol:{down:"\u25BC",up:"\u25B2"}},Qe=class o{static renderPeerDetails(e,t){let r=v,s=e.getError()!==f._ErrNone;t.classList.toggle("error",s);let i=e.getErrorMessage();if(i)h(t,i);else if(e.isDownloading()){let n=e.getPeersConnected(),l=e.getWebseedsSendingToUs(),a=["Downloading from"];n&&(a.push(e.getPeersSendingToUs(),"of",r.countString("peer","peers",n)),l&&a.push("and")),l&&a.push(r.countString("web seed","web seeds",l)),a.push("-",L.symbol.down,r.speedBps(e.getDownloadSpeed()),L.symbol.up,r.speedBps(e.getUploadSpeed())),h(t,a.join(" "))}else if(e.isSeeding()){let n=["Seeding to",e.getPeersGettingFromUs(),"of",r.countString("peer","peers",e.getPeersConnected()),"-",L.symbol.up,r.speedBps(e.getUploadSpeed())].join(" ");h(t,n)}else if(e.isChecking()){let n=["Verifying local data (",r.percentString(100*e.getRecheckProgress(),1),"% tested)"].join("");h(t,n)}else h(t,e.getStateString())}static renderProgressDetails(e,t,r){let s=v;if(t.needsMetaData()){let c="retrieving";t.isStopped()&&(c="needs");let g=100*t.getMetadataPercentComplete(),u=["Magnetized transfer - ",c," metadata (",s.percentString(g,1),"%)"].join("");h(r,u);return}let i=t.getSizeWhenDone(),n=t.getTotalSize(),l=t.isDone()||t.isSeeding(),a=[];if(l?(n===i?a.push(s.size(n)):a.push(s.size(i)," of ",s.size(t.getTotalSize())," (",t.getPercentDoneStr(),"%)"),a.push(", uploaded ",s.size(t.getUploadedEver())," (Ratio: ",s.ratioString(t.getUploadRatio()),")")):a.push(s.size(i-t.getLeftUntilDone())," of ",s.size(i)," (",t.getPercentDoneStr(),"%)"),!t.isStopped()&&(!l||t.seedRatioLimit(e)>0)){a.push(" - ");let c=t.getETA();c<0||c>=999*60*60?a.push("remaining time unknown"):a.push(s.timeInterval(t.getETA(),1)," remaining")}h(r,a.join(""))}render(e,t,r){let s=t.isStopped();r.classList.toggle("paused",s);let{button:i,labels:n,name:l,peer_details:a,progressbar:c,progress_details:g}=r;h(l,t.getName()),L.formatLabels(t,n),o.renderProgressDetails(e,t,g),L.renderProgressbar(e,t,c),c.classList.add("full"),i.alt=s?"Resume":"Pause",i.dataset.action=s?"resume":"pause",o.renderPeerDetails(t,a)}createRow(e){let t=document.createElement("li");t.className="torrent";let r=[["select","select"],["name","torrent-name"],["labels","torrent-labels"],["progress_details","torrent-progress-details"],["progress","torrent-progress"],["peer_details","torrent-peer-details"]];for(let[n,l]of r){let a=document.createElement("div");a.className=l,t.append(a),t[n]=a}L.renderSelectIcon(t.select,e);let s=document.createElement("div");s.className="torrent-progress-bar full";let i=document.createElement("a");return i.className="torrent-pauseresume-button",t.progress.append(s,i),t.progressbar=s,t.button=i,t}},Ue=class o{static renderPeerDetails(e,t){let r=v,s=e.getError()!==f._ErrNone;t.classList.toggle("error",s);let i=e.getErrorMessage();if(i)h(t,i);else if(e.isDownloading()){let n=e.getDownloadSpeed()>0,l=e.getUploadSpeed()>0;if(!l&&!n)h(t,"Idle");else{let a=[L.formatETA(e)];n&&a.push(L.symbol.down,r.speedBps(e.getDownloadSpeed())),l&&a.push(L.symbol.up,r.speedBps(e.getUploadSpeed())),h(t,a.join(" "))}}else if(e.isSeeding()){let n=["Ratio:",r.ratioString(e.getUploadRatio()),"-",L.symbol.up,r.speedBps(e.getUploadSpeed())].join(" ");h(t,n)}else h(t,e.getStateString())}render(e,t,r){r.classList.toggle("paused",t.isStopped());let{labels:s,name:i,peer_details:n,progressbar:l}=r;h(i,t.getName()),L.formatLabels(t,s),o.renderPeerDetails(t,n),L.renderProgressbar(e,t,l),l.classList.add("compact")}createRow(e){let t=document.createElement("li");t.className="torrent compact";let r=[["select","select"],["name","torrent-name compact"],["labels","torrent-labels compact"],["peer_details","torrent-peer-details compact"],["progressbar","torrent-progress-bar compact"]];for(let[s,i]of r){let n=document.createElement("div");n.className=i,t.append(n),t[s]=n}return L.renderSelectIcon(t.select,e),t}},ke=class{constructor(e,t,r){this._view=e,this._torrent=r,this._element=e.createRow(r);let s=()=>this.render(t);this._torrent.addEventListener("dataChanged",s),s()}getElement(){return this._element}render(e){let t=this.getTorrent();t&&this._view.render(e,t,this.getElement())}isSelected(){return this.getElement().classList.contains("selected")}getTorrent(){return this._torrent}getTorrentId(){return this.getTorrent().getId()}};var Oe=class o extends EventTarget{constructor(e,t,r){super(),this.action_manager=e,this.action_input_value=null,this.notifications=t,this.prefs=r,this.remote=new oe(this),this.addEventListener("torrent-selection-changed",n=>this.action_manager.update(n)),this.filterText="",this._filter={},this._torrents={},this._rows=[],this.dirtyTorrents=new Set,this.changeStatus=!1,this.refilterSoon=E(()=>this._refilter(!1)),this.refilterAllSoon=E(()=>this._refilter(!0)),this.popup=Array.from({length:o.max_popups}).fill(null),this.isTouch="ontouchstart"in window,this.busyclick=!1;for(let n of document.querySelectorAll("button[data-action]")){let{action:l}=n.dataset;w(n,this.action_manager.isEnabled(l)),n.addEventListener("click",()=>{this.action_manager.click(l)})}document.querySelector("#filter-tracker").addEventListener("change",n=>{this.setFilterTracker(n.target.value==="all"?null:n.target.value)}),this.action_manager.addEventListener("change",n=>{for(let l of document.querySelectorAll(`[data-action="${n.action}"]`))w(l,n.enabled)}),this.action_manager.addEventListener("click",n=>{switch(n.action){case"deselect-all":this._deselectAll();break;case"move-bottom":this._moveBottom();break;case"move-down":this._moveDown();break;case"move-top":this._moveTop();break;case"move-up":this._moveUp();break;case"open-torrent":this.setCurrentPopup(new M(this,this.remote));break;case"pause-all-torrents":this._stopTorrents(this._getAllTorrents());break;case"pause-selected-torrents":this._stopTorrents(this.getSelectedTorrents());break;case"reannounce-selected-torrents":this._reannounceTorrents(this.getSelectedTorrents());break;case"remove-selected-torrents":this._removeSelectedTorrents();break;case"resume-selected-torrents":this._startSelectedTorrents(!1);break;case"resume-selected-torrents-now":this._startSelectedTorrents(!0);break;case"select-all":this._selectAll();break;case"show-about-dialog":this.setCurrentPopup(new Be(this.version_info));break;case"show-inspector":this.popup[0]instanceof re?this.popup[0].close():this.setCurrentPopup(new re(this),0);break;case"show-move-dialog":this.setCurrentPopup(new xe(this,this.remote,this.action_input_value));break;case"show-overflow-menu":this.popup[o.default_popup_level]instanceof se?this.popup[o.default_popup_level].close():this.setCurrentPopup(new se(this,this.prefs,this.remote,this.action_manager));break;case"show-preferences-dialog":this.setCurrentPopup(new Ze(this,this.remote),0);break;case"show-shortcuts-dialog":this.setCurrentPopup(new Le(this.action_manager));break;case"show-statistics-dialog":this.setCurrentPopup(new we(this.remote));break;case"show-rename-dialog":this.setCurrentPopup(new Fe(this,this.remote,this.action_input_value));break;case"show-labels-dialog":this.setCurrentPopup(new We(this,this.remote,this.action_input_value));break;case"start-all-torrents":this._startTorrents(this._getAllTorrents());break;case"toggle-compact-rows":this.prefs.display_mode=this.prefs.display_mode===m.DisplayCompact?m.DisplayFull:m.DisplayCompact;break;case"verify-selected-torrents":this._verifyTorrents(this.getSelectedTorrents());break;default:console.warn(`unhandled action: ${n.action}`)}this.action_input_value=null});let s=document.querySelector("#filter-mode");s.value=this.prefs.filter_mode,s.addEventListener("change",n=>{this.prefs.filter_mode=n.target.value,this.refilterAllSoon()}),s=document.querySelector("#turtle"),s.addEventListener("click",n=>{this.remote.savePrefs({[Z._TurtleState]:!n.target.classList.contains("alt-speed-enabled")})}),document.addEventListener("keydown",this._keyDown.bind(this)),document.addEventListener("keyup",this._keyUp.bind(this)),s=document.querySelector("#torrent-container"),s.addEventListener("click",n=>{this.popup[o.default_popup_level]&&this.setCurrentPopup(null),n.target===n.currentTarget&&this._deselectAll()}),s.addEventListener("dblclick",n=>{!n.target.classList.contains("select")&&(!this.popup[0]||this.popup[0].name!=="inspector")&&this.action_manager.click("show-inspector")}),s.addEventListener("dragenter",o._dragenter),s.addEventListener("dragover",o._dragenter),s.addEventListener("drop",this._drop.bind(this)),this._setupSearchBox(),this.elements={torrent_list:document.querySelector("#torrent-list")};let i=n=>{if(this.isTouch&&n.touches.length>1)return;let l=n.target;for(;l&&!l.classList.contains("torrent");)l=l.parentNode;let a=this._rows.find(b=>b.getElement()===l);a&&!a.isSelected()&&this._setSelectedRow(a);let c=new Ge(this.action_manager);this.setCurrentPopup(c);let u=document.querySelector("#torrent-container").getBoundingClientRect(),d=Math.min(this.isTouch?n.touches[0].pageX:n.pageX,u.right+globalThis.scrollX-c.root.clientWidth),p=Math.min(this.isTouch?n.touches[0].pageY:n.pageY,u.bottom+globalThis.scrollY-c.root.clientHeight);c.root.style.left=`${Math.max(d,0)}px`,c.root.style.top=`${Math.max(p,0)}px`,n.preventDefault()};this.isTouch?(this.elements.torrent_list.addEventListener("touchstart",n=>{this.busyclick?(clearTimeout(this.busyclick),this.busyclick=!1):this.busyclick=setTimeout(i.bind(this),500,n)}),this.elements.torrent_list.addEventListener("touchend",()=>{clearTimeout(this.busyclick),this.busyclick=!1,setTimeout(()=>{let n=this.popup[o.default_popup_level];n&&(n.root.style.pointerEvents="auto")},1)}),this.elements.torrent_list.addEventListener("touchmove",()=>{clearTimeout(this.busyclick),this.busyclick=!1}),this.elements.torrent_list.addEventListener("contextmenu",n=>{n.preventDefault()})):this.elements.torrent_list.addEventListener("contextmenu",n=>{i(n);let l=this.popup[o.default_popup_level];l&&(l.root.style.pointerEvents="auto")}),this.loadDaemonPrefs(),this._initializeTorrents(),this.refreshTorrents(),this.togglePeriodicSessionRefresh(!0),this.prefs.addEventListener("change",({key:n,value:l})=>this._onPrefChanged(n,l));for(let[n,l]of this.prefs.entries())this._onPrefChanged(n,l)}_openTorrentFromUrl(){setTimeout(()=>{let e=new URLSearchParams(window.location.search).get("addtorrent");if(e){this.setCurrentPopup(new M(this,this.remote,e));let t=new URL(window.location);t.search="",window.history.pushState("","",t.toString())}},0)}loadDaemonPrefs(){this.remote.loadDaemonPrefs(e=>{this.session_properties=e.arguments,this._openTorrentFromUrl()})}get session_properties(){return this._session_properties}set session_properties(e){if(Ce(this._session_properties,e))return;this._session_properties=Object.seal(e);let t=new Event("session-change");t.session_properties=e,this.dispatchEvent(t),this._updateGuiFromSession(e)}_setupSearchBox(){let e=document.querySelector("#torrent-search"),t="blur";e.classList.add(t),e.addEventListener("blur",()=>e.classList.add(t)),e.addEventListener("focus",()=>e.classList.remove(t)),e.addEventListener("keyup",()=>this._setFilterText(e.value))}_onPrefChanged(e,t){switch(e){case m.DisplayMode:{this.torrentRenderer=t==="compact"?new Ue:new Qe,this.refilterAllSoon();break}case m.ContrastMode:{document.body.classList.remove("contrast-more"),document.body.classList.remove("contrast-less"),document.body.classList.add(`contrast-${t}`);break}case m.FilterMode:case m.SortDirection:case m.SortMode:this.refilterAllSoon();break;case m.RefreshRate:{clearTimeout(this.refreshTimeoutId);let r=this.refreshTorrents.bind(this),s=this.prefs.refresh_rate_sec,i=s>0?s*1e3:1e3,n=()=>{r(),this.refreshTimeoutId=setTimeout(()=>{this.refreshTimeoutId=null,requestAnimationFrame(()=>{this.refreshTimeoutId||n()})},i)};n();break}default:break}}static get max_popups(){return 2}static get default_popup_level(){return o.max_popups-1}_getAllTorrents(){return Object.values(this._torrents)}static _getTorrentIds(e){return e.map(t=>t.getId())}seedRatioLimit(){let e=this.session_properties;return e&&e.seedRatioLimited?e.seedRatioLimit:-1}_getSelectedRows(){return this._rows.filter(e=>e.isSelected())}getSelectedTorrents(){return this._getSelectedRows().map(e=>e.getTorrent())}_getSelectedTorrentIds(){return o._getTorrentIds(this.getSelectedTorrents())}_setSelectedRow(e){let t=e?e.getElement():null;for(let r of this.elements.torrent_list.children)r.classList.toggle("selected",r===t);this._dispatchSelectionChanged()}_selectRow(e){e.getElement().classList.add("selected"),this._dispatchSelectionChanged()}_deselectRow(e){e.getElement().classList.remove("selected"),this._dispatchSelectionChanged()}_selectAll(){for(let e of this.elements.torrent_list.children)e.classList.add("selected");this._dispatchSelectionChanged()}_deselectAll(){for(let e of this.elements.torrent_list.children)e.classList.remove("selected");this._dispatchSelectionChanged(),delete this._last_torrent_clicked}_indexOfLastTorrent(){return this._rows.findIndex(e=>e.getTorrentId()===this._last_torrent_clicked)}_selectRange(e){let t=this._indexOfLastTorrent();if(t===-1)this._selectRow(e);else{let r=this._rows.indexOf(e),s=Math.min(t,r),i=Math.max(t,r);for(let n=s;n<=i;++n)this._selectRow(this._rows[n])}this._dispatchSelectionChanged()}_dispatchSelectionChanged(){let e=[],t=[];for(let s of this._rows)(s.isSelected()?t:e).push(s.getTorrent());let r=new Event("torrent-selection-changed");r.nonselected=e,r.selected=t,this.dispatchEvent(r)}static _createKeyShortcutFromKeyboardEvent(e){let t=[];return e.ctrlKey&&t.push("Control"),e.altKey&&t.push("Alt"),e.metaKey&&t.push("Meta"),e.shiftKey&&t.push("Shift"),t.push(e.key.length===1?e.key.toUpperCase():e.key),t.join("+")}_keyDown(e){let{ctrlKey:t,keyCode:r,metaKey:s,shiftKey:i,target:n}=e,l=["INPUT","TEXTAREA"].includes(n.tagName);if(!l){let u=o._createKeyShortcutFromKeyboardEvent(e),d=this.action_manager.getActionForShortcut(u);if(d){e.preventDefault(),this.action_manager.click(d);return}}if(r===27&&this.popup.some(Boolean)){this.setCurrentPopup(null,0),e.preventDefault();return}let c=document.querySelector(".popup:not(.hidden)"),g=this._rows;if(!l&&!c&&!s&&!t){let u=r===16,d=r===38,p=r===40;if((d||p)&&g.length>0){let b=this._indexOfLastTorrent(),I=this._shift_index,A=0,y=g.length-1,G=b;p&&G+1<=y?++G:d&&G-1>=A&&--G;let B=g[G];I>=0?I<=b&&b<G||I>=b&&b>G?this._selectRow(B):(I>=b&&G>b||I<=b&&b>G)&&this._deselectRow(g[b]):i?this._selectRange(B):this._setSelectedRow(B),B&&(this._last_torrent_clicked=B.getTorrentId(),B.getElement().scrollIntoView(),e.preventDefault())}else u&&(this._shift_index=this._indexOfLastTorrent())}}_keyUp(e){e.keyCode===16&&delete this._shift_index}static _dragenter(e){if(e.dataTransfer&&e.dataTransfer.types){let t=new Set(["text/uri-list","text/plain"]);if(e.dataTransfer.types.some(r=>t.has(r))||e.dataTransfer.types.includes("Files"))return e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy",!1}else e.dataTransfer&&(e.dataTransfer.dropEffect="none");return!0}static _isValidURL(e){try{return!!new URL(e)}catch{return!1}}shouldAddedTorrentsStart(){return this.session_properties["start-added-torrents"]}_drop(e){let t=!this.shouldAddedTorrentsStart();if(!e.dataTransfer||!e.dataTransfer.types)return!0;let r=e.dataTransfer.types.findLast(i=>["text/uri-list","text/plain"].includes(i));for(let i of e.dataTransfer.getData(r).split(`
`).map(n=>n.trim()).filter(n=>o._isValidURL(n)))this.remote.addTorrentByUrl(i,t);let{files:s}=e.dataTransfer;return s.length>0&&this.setCurrentPopup(new M(this,this.remote,"",s)),e.preventDefault(),!1}togglePeriodicSessionRefresh(e){!e&&this.sessionInterval&&(clearInterval(this.sessionInterval),delete this.sessionInterval),e&&(this.loadDaemonPrefs(),this.sessionInterval||(this.sessionInterval=setInterval(this.loadDaemonPrefs.bind(this),8e3)))}_setFilterText(e){this.filterText=e?e.trim():null,this.refilterAllSoon()}_onTorrentChanged(e){this.changeStatus&&(this._dispatchSelectionChanged(),this.changeStatus=!1);let t=e.currentTarget;this.dirtyTorrents.add(t.getId()),this.refilterSoon()}updateTorrents(e,t){this.remote.updateTorrents(e,t,(r,s)=>{let i=[],n=r.shift(),l={};for(let a of r){for(let[u,d]of n.entries())l[d]=a[u];let{id:c}=l,g=this._torrents[c];if(g){let u=g.needsMetaData();g.refresh(l),u&&!g.needsMetaData()&&i.push(c)}else g=this._torrents[c]=new f(l),g.addEventListener("dataChanged",this._onTorrentChanged.bind(this)),this.dirtyTorrents.add(c),(!("name"in g.fields)||!("status"in g.fields))&&i.push(c)}if(i.length>0){let a=["id",...f.Fields.Metadata,...f.Fields.Stats];this.updateTorrents(i,a),this.refilterSoon()}s&&(this._deleteTorrents(s),this.refilterSoon())})}refreshTorrents(){let e=["id",...f.Fields.Stats];this.updateTorrents("recently-active",e)}_initializeTorrents(){let e=["id",...f.Fields.Metadata,...f.Fields.Stats];this.updateTorrents(null,e)}_onRowClicked(e){let t=e.metaKey||e.ctrlKey,{row:r}=e.currentTarget;if(this.popup[o.default_popup_level]&&this.setCurrentPopup(null),e.target.classList.contains("torrent-pauseresume-button"))switch(e.target.dataset.action){case"pause":this._stopTorrents([r.getTorrent()]);break;case"resume":this._startTorrents([r.getTorrent()]);break;default:break}e.stopPropagation(),e.shiftKey?(this._selectRange(r),window.focus()):!r.isSelected()&&(e.target.classList.contains("select")||t)?this._selectRow(r):r.isSelected()?r.isSelected()&&(e.target.classList.contains("select")||t)?this._deselectRow(r):r.isSelected()&&this._setSelectedRow(r):this._setSelectedRow(r),this._last_torrent_clicked=r.getTorrentId()}_deleteTorrents(e){if(e&&e.length>0){for(let t of e)this.dirtyTorrents.add(t),delete this._torrents[t];this.refilterSoon()}}_removeSelectedTorrents(){let e=this.getSelectedTorrents();e.length>0&&this.setCurrentPopup(new Xe({remote:this.remote,torrents:e}))}_startSelectedTorrents(e){this._startTorrents(this.getSelectedTorrents(),e)}_startTorrents(e,t){this.changeStatus=!0,this.remote.startTorrents(o._getTorrentIds(e),t,this.refreshTorrents,this)}_verifyTorrents(e){this.remote.verifyTorrents(o._getTorrentIds(e),this.refreshTorrents,this)}_reannounceTorrents(e){this.remote.reannounceTorrents(o._getTorrentIds(e),this.refreshTorrents,this)}_stopTorrents(e){this.changeStatus=!0,this.remote.stopTorrents(o._getTorrentIds(e),()=>{setTimeout(()=>{this.refreshTorrents()},500)},this)}changeFileCommand(e,t,r){this.remote.changeFileCommand(e,t,r)}_moveTop(){this.remote.moveTorrentsToTop(this._getSelectedTorrentIds(),this.refreshTorrents,this)}_moveUp(){this.remote.moveTorrentsUp(this._getSelectedTorrentIds(),this.refreshTorrents,this)}_moveDown(){this.remote.moveTorrentsDown(this._getSelectedTorrentIds(),this.refreshTorrents,this)}_moveBottom(){this.remote.moveTorrentsToBottom(this._getSelectedTorrentIds(),this.refreshTorrents,this)}_updateGuiFromSession(e){let[,t,r]=e.version.match(/(.*)\s\(([\da-f]+)\)/);this.version_info={checksum:r,version:t},document.querySelector("#turtle").classList.toggle("alt-speed-enabled",e[Z._TurtleState])}_updateStatusbar(){let e=v,t=this._getAllTorrents(),r=t.reduce((n,l)=>n+l.getUploadSpeed(),0),s=t.reduce((n,l)=>n+l.getDownloadSpeed(),0),i=e.countString("Transfer","Transfers",this._rows.length);h(document.querySelector("#speed-up-label"),e.speedBps(r)),h(document.querySelector("#speed-dn-label"),e.speedBps(s)),h(document.querySelector("#filter-count"),i)}static _displayName(e){let t=e;return t.length>0&&(t=t.charAt(0).toUpperCase()+t.slice(1)),t}_updateFilterSelect(){let e=this._getTrackerCounts(),t=Object.keys(e).sort(),r="";r+=this.filterTracker?'<option value="all">All</option>':'<option value="all" selected="selected">All</option>';for(let s of t)r+=`<option value="${s}"`,s===this.filterTracker&&(r+=' selected="selected"'),r+=`>${o._displayName(s)}</option>`;(!this.filterTrackersStr||this.filterTrackersStr!==r)&&(this.filterTrackersStr=r,document.querySelector("#filter-tracker").innerHTML=r)}sortRows(e){let t=e.map(s=>s.getTorrent()),r=e.reduce((s,i)=>(s[i.getTorrent().getId()]=i,s),{});f.sortTorrents(t,this.prefs.sort_mode,this.prefs.sort_direction);for(let[s,i]of t.entries())e[s]=r[i.getId()]}_registerFilter(e){let t={label:["labels:","label:","kw:"],name:["name:"],status:["status:","is:"],tracker:["tracker:","tr:"]},r=[[t.name,"search"],[t.label,"labels"],[t.status,"states",[m.FilterActive,m.FilterDownloading,m.FilterSeeding,m.FilterPaused,m.FilterFinished]],[t.tracker,"trackers"],[]],s=e;for(let[i,n,l]of r){if(i){if(i=i.find(a=>e.startsWith(a)),!i)continue;s=e.slice(i.length),this._filter.autocomplete=l,this._filter.controller=this._filter[n]}if(n=this._filter.controller,n){let a=s.split(/,+/);if(l=this._filter.autocomplete,l){let c=[];for(let g of a)g&&c.push(l.find(u=>u.startsWith(g)));a=c}i?n.push(a):n.at(-1).push(...a),s&&!s.endsWith(",")&&(this._filter.autocomplete=null,this._filter.controller=null);return}}this._filter.opless.push(s)}_rebuildFilter(){let{filter_mode:e}=this.prefs;if(this._filter.search=[],this._filter.labels=[],this._filter.states=e===m.FilterAll?[]:[[e]],this._filter.trackers=this.filterTracker?[[this.filterTracker]]:[],this.filterText){this._filter.autocomplete=null,this._filter.controller=null,this._filter.opless=[];let t=this.filterText.match(/(?:\\.|[^"])+|^/g);for(let[r,s]of t.entries()){let i=s.replaceAll(/\\(.)/g,"$1");if(r%2){let n=this._filter.controller;if(n){let l=this._filter.autocomplete;n.at(-1).push(l?l.find(a=>a.startsWith(i)):i)}else this._filter.opless.push(i)}else for(let n of i.trimEnd().toLowerCase().split(/ +/))n?this._registerFilter(n):(this._filter.autocomplete=null,this._filter.controller=null)}this._filter.opless.length>0&&this._filter.search.push(this._filter.opless)}}_refilter(e){let{sort_mode:t,sort_direction:r}=this.prefs,s=this.torrentRenderer,i=this.elements.torrent_list,n=()=>[...i.children].length,l=()=>[...i.children].reduce((B,C)=>B+C.classList.contains("selected")?1:0,0),a=n(),c=l();if(this._updateFilterSelect(),e){for(this._rebuildFilter();i.firstChild;)i.lastChild.remove();this._rows=[],this.dirtyTorrents=new Set(Object.keys(this._torrents))}let g=[],u=[];for(let B of this._rows)this.dirtyTorrents.has(B.getTorrentId())?u.push(B):g.push(B);for(let B of u)B.getElement().remove();let d=[];for(let B of u){let C=B.getTorrentId(),x=this._torrents[C];x&&x.test(this._filter)&&d.push(B),this.dirtyTorrents.delete(C)}u=d;for(let B of this.dirtyTorrents.values()){let C=this._torrents[B];if(C&&C.test(this._filter)){let x=new ke(s,this,C),Q=x.getElement();Q.row=x,u.push(x),Q.addEventListener("click",this._onRowClicked.bind(this))}}this.sortRows(u);let p=[],b=g.length,I=u.length,A=document.createDocumentFragment(),y=0,G=0;for(;y!==b||G!==I;){let B=null;if(y===b?B=!1:G===I?B=!0:B=f.compareTorrents(g[y].getTorrent(),u[G].getTorrent(),t,r)<0,B)p.push(g[y++]);else{let C=u[G++],x=C.getElement();y===b?A.append(x):i.insertBefore(x,g[y].getElement()),p.push(C)}}i.append(A),this._rows=p,this.dirtyTorrents.clear(),this._updateStatusbar(),(c!==l()||a!==n())&&this._dispatchSelectionChanged()}setFilterTracker(e){let t=document.querySelector("#filter-tracker");t.value=e,this.filterTracker=e,this.refilterAllSoon()}_getTrackerCounts(){let e={};for(let t of this._getAllTorrents())for(let r of t.getTrackers()){let{sitename:s}=r;e[s]=(e[s]||0)+1}return e}setCurrentPopup(e,t=o.default_popup_level){for(let r=t;r<o.max_popups;r++)this.popup[r]&&this.popup[r].close();if(this.popup[t]=e,this.popup[t]){let r=()=>{this.popup[t]&&(this.popup[t].removeEventListener("close",r),this.popup[t]=null)};this.popup[t].addEventListener("close",r)}}};function Fo(){let o=new ie,e=new m,t=new fe(e),r=new Oe(o,t,e),s=E(()=>r.elements.torrent_list.scrollTo(0,1));window.addEventListener("load",s),window.addEventListener("orientationchange",s)}document.addEventListener("DOMContentLoaded",Fo);})();
//# sourceMappingURL=transmission-app.js.map
